---
title: "plots for paper"
author: "Samantha Andrews"
output: html_notebook
---

# Overview
A note to anyone who might happen to stumble across this... I am a beginner in R and have had no exposure to similar languages. I don't know what I'm doing. The code herein is unlikely to be elegant and there area probably more efficient ways of running the code.

Built with 'r getRversion()'..

# Package dependencies
You can install and load them using the following code which uses a function called [ipak](https://gist.github.com/stevenworthington/3178163). Note this function checks to see if the packages are installed first before loading.


```{r pre-install & load packages, include=FALSE}
packages <- c("stringr", "reshape2", "ggplot2", "Hmisc", "viridis", "raster", "RColorBrewer", "cowplot", "rasterVis")
source("../src/ipak.R")
ipak(packages)
```



# stacked permutation importance plot and jacknife plots

```{r create permutation & jack data}
maxr_lst <- list.files("../output/maxent/models/", pattern = "maxentresults.csv", full.names = TRUE)
maxr_lst <- maxr_lst[-4] #removing january because this month has slightly different variables than the others
perm <- data.frame(matrix(ncol = 10, nrow = length(maxr_lst)))
colnames(perm) <- c("Month", "amo_sample", "amo_winter", "chl_surface", "nao_prev", "nao_sample", "nao_winter", "o2_depth", "salinity_depth", "temp_depth")
jack <- data.frame(matrix(ncol = 10, nrow = length(maxr_lst)))
colnames(jack) <- c("Month", "amo_sample", "amo_winter", "chl_surface", "nao_prev", "nao_sample", "nao_winter", "o2_depth", "salinity_depth", "temp_depth")

for (m in 1:length(maxr_lst)){
  maxr <- read.csv(maxr_lst[m])
  mth <- str_sub(maxr_lst[m], start = 25, end = 27) #selects the month from the filename
  perm$Month[m] <- mth
  jack$Month[m] <- mth
  maxt <- tail(maxr, 1)
  perm$amo_sample[m] <- maxt$amo_sample.permutation.importance
  perm$amo_winter[m] <- maxt$amo_winter.permutation.importance
  perm$chl_surface[m] <- maxt$chl_surface.permutation.importance
  perm$nao_prev[m] <- maxt$nao_prev.permutation.importance
  perm$nao_sample[m] <- maxt$nao_sample.permutation.importance
  perm$nao_winter[m] <- maxt$nao_winter.permutation.importance
  perm$o2_depth[m] <- maxt$o2_depth.permutation.importance
  perm$salinity_depth[m] <- maxt$salinity_depth.permutation.importance
  perm$temp_depth[m] <- maxt$temp_depth.permutation.importance

  jack$amo_sample[m] <- maxt$Training.gain.without.amo_sample
  jack$amo_winter[m] <- maxt$Training.gain.without.amo_winter
  jack$chl_surface[m] <- maxt$Training.gain.without.chl_surface
  jack$nao_prev[m] <- maxt$Training.gain.without.nao_prev
  jack$nao_sample[m] <- maxt$Training.gain.without.nao_sample
  jack$nao_winter[m] <- maxt$Training.gain.without.nao_winter
  jack$o2_depth[m] <- maxt$Training.gain.without.o2_depth
  jack$salinity_depth[m] <- maxt$Training.gain.without.salinity_depth
  jack$temp_depth[m] <- maxt$Training.gain.without.temp_depth
}


mthord <- c("mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec") # a list of months to order by
permu <- perm[match(mthord, perm$Month), ] #reorder based on mthord
jackk <- jack[match(mthord, jack$Month), ] #reorder based on mthord

#rename the months so they are capitalised
permu$Month <- capitalize(permu$Month)
jackk$Month <- capitalize(jackk$Month)


#rename the col names so they are capitalised and shortened
colnames(permu)[colnames(permu)=="amo_sample"] <- "AMO_Sample"
colnames(permu)[colnames(permu)=="amo_winter"] <- "AMO_Winter"
colnames(permu)[colnames(permu)=="chl_surface"] <- "Chl_Surface"
colnames(permu)[colnames(permu)=="nao_prev"] <- "NAO_Prev"
colnames(permu)[colnames(permu)=="nao_sample"] <- "NAO_Sample"
colnames(permu)[colnames(permu)=="nao_winter"] <- "NAO_Winter"
colnames(permu)[colnames(permu)=="o2_depth"] <- "O2_Depth"
colnames(permu)[colnames(permu)=="salinity_depth"] <- "Salinity_Depth"
colnames(permu)[colnames(permu)=="temp_depth"] <- "Temp_Depth"

colnames(jackk)[colnames(jackk)=="amo_sample"] <- "AMO_Sample"
colnames(jackk)[colnames(jackk)=="amo_winter"] <- "AMO_Winter"
colnames(jackk)[colnames(jackk)=="chl_surface"] <- "Chl_Surface"
colnames(jackk)[colnames(jackk)=="nao_prev"] <- "NAO_Prev"
colnames(jackk)[colnames(jackk)=="nao_sample"] <- "NAO_Sample"
colnames(jackk)[colnames(jackk)=="nao_winter"] <- "NAO_Winter"
colnames(jackk)[colnames(jackk)=="o2_depth"] <- "O2_Depth"
colnames(jackk)[colnames(jackk)=="salinity_depth"] <- "Salinity_Depth"
colnames(jackk)[colnames(jackk)=="temp_depth"] <- "Temp_Depth"


write.csv(permu, "../output/maxent/models/permutation_avg.csv", row.names = FALSE)
write.csv(jackk, "../output/maxent/models/jack_avg.csv", row.names = FALSE)

```

```{r create jacknife plots}
maxr_lst <- list.files("../output/maxent/models/", pattern = "maxentresults.csv", full.names = TRUE)
maxr_lst <- maxr_lst[-4] #removing january because this month has slightly different variables than the others
jack_df <- list()


for (m in 1:length(maxr_lst)){
  res <- read.csv(maxr_lst[m], header = TRUE)
  mth <- str_sub(maxr_lst[m], start = 25, end = 27) #selects the month from the filename
  mth <- capitalize(mth)
  res_df <- tail(res, 1)
  var_df <- res_df[,c(grep("Training.gain.with*",names(res_df)))]
  var_df$id <- 1:nrow(var_df)
  var_df <- melt(var_df, id.vars=c("id"))
  jack_with <- var_df[grep("with.only",var_df$variable),]
  jack_with$Type_of_Run <- "With only the variable"
  jack_without <- var_df[grep("without",var_df$variable),]
  jack_without$Type_of_Run <- "Without the variable"
  gain_all <- res_df[c(grep("Regularized.",names(res_df)))]
  gain_all$id <- 1:nrow(gain_all)
  gain_all <- melt(gain_all, id.vars=c("id"))
  gain_all$Type_of_Run <- "With all variables"
  gain_all$variable <- "all_variables"
  jack_table <- rbind(jack_with,jack_without,gain_all)
  jack_table$state <- mth 
  

  jack_table$variable <- gsub(".*[.]","",jack_table$variable)
  jack_table$variable <- gsub("amo_sample", "AMO_Sample", jack_table$variable)
  jack_table$variable <- gsub("amo_winter", "AMO_Winter", jack_table$variable)
  jack_table$variable <- gsub("chl_surface", "Chl_Surface", jack_table$variable)
  jack_table$variable <- gsub("nao_prev", "NAO_prev", jack_table$variable)
  jack_table$variable <- gsub("nao_sample", "NAO_Sample", jack_table$variable)
  jack_table$variable <- gsub("nao_winter", "NAO_Winter", jack_table$variable)
  jack_table$variable <- gsub("o2_depth", "O2_Depth", jack_table$variable)
  jack_table$variable <- gsub("salinity_depth", "Salinity_Depth", jack_table$variable)
  jack_table$variable <- gsub("temp_depth", "Temp_Depth", jack_table$variable)

  jack_df[[m]] <- jack_table
  
}

var_jack <- do.call(rbind, jack_df)

var_jack$state <- factor(var_jack$state,levels=c("Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
var_jack$Type_of_Run <- factor(var_jack$Type_of_Run,levels=c("With all variables", "Without the variable","With only the variable"))
a <- subset(var_jack, state == "Mar" | state == "Apr" |state == "May" | state == "Jun" | state == "Jul")
b <- subset(var_jack, state == "Aug" | state == "Sep" |state == "Oct" | state == "Nov" | state == "Dec")


plotlst <- list(a, b)

color_type_1 <- c("#081d58", "#999999","#1d91c0")
varpos <- c("Temp_Depth", "Salinity_Depth", "O2_Depth", "Chl_Surface", "NAO_Sample", "NAO_Prev", "NAO_Winter", "AMO_Sample", "AMO_Winter")

for (p in 1:length(plotlst)){
  pt <- p
  dev.new()
  jack <- ggplot(plotlst[[p]], aes(variable,value))+
  geom_bar(aes(fill=Type_of_Run),position="dodge",stat="identity")+ coord_flip()+ facet_grid(state~., scales="free", space = "free")+
  theme_bw(14)+
  scale_fill_manual(values=color_type_1,guide=guide_legend(reverse=FALSE))+
  theme(axis.text=element_text(size=8)) +
  theme(legend.title=element_blank())+
  theme(legend.position="top")+
  theme(strip.text=element_text(size=12))+
  theme(strip.text.y = element_text(angle = 0)) +
  labs(x="Variable",y="Jackknife of Regularized Training Gain")
  ggsave(filename = paste0("../output/maxent/paper_plots/jackknife_plot_", pt, ".png"), plot = jack, dpi = 900, height = 9, width = 7)
  dev.off()
}

```

```{r permulation plot}
permu <- read.csv("../output/maxent/models/permutation_avg.csv")

mthna <- c("Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")

permelt <- melt(permu, id = "Month") #need to melt the data into this format for ggplot
perpl <- ggplot(data = permelt, aes(x = Month, y = value, fill = variable)) + geom_bar(stat = "identity") +  scale_fill_viridis_d(direction = 1) + theme_half_open(12) + scale_x_discrete(limits = mthna) + labs(y = "Permutation Importance (%)")
png("../output/maxent/paper_plots/permutation_plot.png")
print(perpl)
dev.off()
```

# plot median probability by depth


```{r get median probability for each depth}
mthord <- c("mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec") 

meddf <- data.frame(matrix(ncol = 3, nrow = 490))
colnames(meddf) <- c("layer", "month", "median")
r <- 1

for (m in 1:length(mthord)){
  mth <- mthord[m]
  mthlst <- list.files(paste0("../output/maxent/predictions/", mth), pattern = "^avg_cloglog.*.asc", full.names = TRUE)
  rstk <- stack(mthlst)
  rsum <- summary(rstk, na.rm = TRUE)
  rsum <- rsum["Median", ]
  for (l in 1:length(rsum)){
    meddf$median[r] <- rsum[l]
    meddf$month[r] <- mth
    meddf$layer[r] <- names(rstk[[l]])
    r <- r+1
  }
}

#rename the layers to be just the depth

meddf$layer <- gsub("avg_cloglog_", "", x = meddf$layer)
meddf <- meddf[order(meddf$layer), ]

write.csv(meddf, paste0("../output/maxent/paper_plots/med_data/median.csv"), row.names = FALSE)
```

```{r}
a <- ggplot(data = meddf) + geom_point(aes(y = layer, x = median, colour = month))
a

```

```{r get max probability for each depth}
mthord <- c("mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec") 

meddf <- data.frame(matrix(ncol = 3, nrow = 490))
colnames(meddf) <- c("layer", "month", "max")
r <- 1

for (m in 1:length(mthord)){
  mth <- mthord[m]
  mthlst <- list.files(paste0("../output/maxent/predictions/", mth), pattern = "^avg_cloglog.*.asc", full.names = TRUE)
  rstk <- stack(mthlst)
  rsum <- summary(rstk, na.rm = TRUE)
  rsum <- rsum["Max.", ]
  for (l in 1:length(rsum)){
    meddf$max[r] <- rsum[l]
    meddf$month[r] <- mth
    meddf$layer[r] <- names(rstk[[l]])
    r <- r+1
  }
}

#rename the layers to be just the depth

meddf$layer <- gsub("avg_cloglog_", "", x = meddf$layer)
meddf$layer <- as.numeric(meddf$layer)
meddf <- meddf[order(meddf$layer), ]

write.csv(meddf, paste0("../output/maxent/paper_plots/med_data/max.csv"), row.names = FALSE)
```

```{r}
a <- ggplot(data = meddf) + geom_point(aes(y = layer, x = max, colour = month))
a
```

#Histograms of probability by depth

count number of cells that are not NA in each raster layer that are inside the mcp

```{r}
outsidemcp <- shapefile("../data/env/landp/mcpout.shp") #made in arcgis

clogasc_list <- list.files(paste0("../output/maxent/predictions/dec"), pattern = "^avg_cloglog_.*.asc", full.names = TRUE) #just choose a random month to calculate cells
cumst <- data.frame(0, 0)
colnames(cumst) <- c("depth", "no_cells")
for (cum in 1:length(clogasc_list)){
  cumasc <- raster(clogasc_list[6])
  ascname <- names(cumasc)
  cumst[cum, 1] <- str_sub(ascname, 13)
  cumasc2 <- raster::mask(cumasc, outsidemcp, inverse = TRUE)
  ccnt <- freq(cumasc2, useNA='no')
  ccnt <- sum(ccnt[ ,2])
  cumst[cum, 2] <- ccnt
}

cumst$depth <- as.numeric(cumst$depth)
cumst1 <- cumst[order(cumst$no_cells), ]

write.csv(cumst1, "../output/maxent/paper_plots/prob_by_depth/cellsperlayermar.csv", row.names = FALSE)

```

first bin the probabilities for cells inside the mcp

```{r bin probabilities}
outsidemcp <- shapefile("../data/env/landp/mcpout.shp") #made in arcgis
mthord <- c("dec") #"mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", 

for (m in 1:length(mthord)){
  mth <- mthord[m]
  clogasc_list <- list.files(paste0("../output/maxent/predictions/", mth), pattern = "^avg_cloglog.*.asc", full.names = TRUE)
  
  binprob <- function(x){
    ifelse(x > 0 & x < 0.1, 0.1,
    ifelse(x <= 0, 0, NA))
  }
  
  for (cum in 1:length(clogasc_list)){
    cumasc <- raster(clogasc_list[cum])
    ascname <- names(cumasc)
    cumasc <- mask(cumasc, outsidemcp, inverse = TRUE)
    probbin <- calc(cumasc, fun = binprob) #creates raster layer with cell values based on the binprob function
    writeRaster(probbin, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_1_avgprob_", ascname, ".asc"), overwrite = TRUE)
    plot(probbin, png(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_1_avgprob_", ascname, ".png")), overwrite = TRUE)
    dev.off() # stops automatic saving of the plot to a png
  }
  
  
  
  binprob <- function(x){
    ifelse(x >= 0.1 & x < 0.2, 0.2,
    ifelse(x <= 0, 0, NA))
  }
  
  for (cum in 1:length(clogasc_list)){
    cumasc <- raster(clogasc_list[cum])
    ascname <- names(cumasc)
    cumasc <- mask(cumasc, outsidemcp, inverse = TRUE)
    probbin <- calc(cumasc, fun = binprob) #creates raster layer with cell values based on the binprob function
    writeRaster(probbin, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_2_avgprob_", ascname, ".asc"), overwrite = TRUE)
    plot(probbin, png(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_2_avgprob_", ascname, ".png")), overwrite = TRUE)
    dev.off() # stops automatic saving of the plot to a png
  }
  
  binprob <- function(x){
    ifelse(x >= 0.2 & x < 0.3, 0.3,
    ifelse(x <= 0, 0, NA))
  }
  
  for (cum in 1:length(clogasc_list)){
    cumasc <- raster(clogasc_list[cum])
    ascname <- names(cumasc)
    cumasc <- mask(cumasc, outsidemcp, inverse = TRUE)
    probbin <- calc(cumasc, fun = binprob) #creates raster layer with cell values based on the binprob function
    writeRaster(probbin, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_3_avgprob_", ascname, ".asc"), overwrite = TRUE)
    plot(probbin, png(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_3_avgprob_", ascname, ".png")), overwrite = TRUE)
    dev.off() # stops automatic saving of the plot to a png
  }
  
  
  binprob <- function(x){
    ifelse(x >= 0.3 & x < 0.4, 0.4,
    ifelse(x <= 0, 0, NA))
  }
  
  for (cum in 1:length(clogasc_list)){
    cumasc <- raster(clogasc_list[cum])
    ascname <- names(cumasc)
    cumasc <- mask(cumasc, outsidemcp, inverse = TRUE)
    probbin <- calc(cumasc, fun = binprob) #creates raster layer with cell values based on the binprob function
    writeRaster(probbin, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_4_avgprob_", ascname, ".asc"), overwrite = TRUE)
    plot(probbin, png(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_4_avgprob_", ascname, ".png")), overwrite = TRUE)
    dev.off() # stops automatic saving of the plot to a png
  }
  
  
  
  binprob <- function(x){
    ifelse(x >= 0.4 & x < 0.5, 0.5,
    ifelse(x <= 0, 0, NA))
  }
  
  for (cum in 1:length(clogasc_list)){
    cumasc <- raster(clogasc_list[cum])
    ascname <- names(cumasc)
    cumasc <- mask(cumasc, outsidemcp, inverse = TRUE)
    probbin <- calc(cumasc, fun = binprob) #creates raster layer with cell values based on the binprob function
    writeRaster(probbin, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_5_avgprob_", ascname, ".asc"), overwrite = TRUE)
    plot(probbin, png(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_5_avgprob_", ascname, ".png")), overwrite = TRUE)
    dev.off() # stops automatic saving of the plot to a png
  }
   
  
  binprob <- function(x){
    ifelse(x >= 0.5 & x < 0.6, 0.6,
    ifelse(x <= 0, 0, NA))
  }
  
  for (cum in 1:length(clogasc_list)){
    cumasc <- raster(clogasc_list[cum])
    ascname <- names(cumasc)
    cumasc <- mask(cumasc, outsidemcp, inverse = TRUE)
    probbin <- calc(cumasc, fun = binprob) #creates raster layer with cell values based on the binprob function
    writeRaster(probbin, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_6_avgprob_", ascname, ".asc"), overwrite = TRUE)
    plot(probbin, png(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_6_avgprob_", ascname, ".png")), overwrite = TRUE)
    dev.off() # stops automatic saving of the plot to a png
  } 
  
  
  
  binprob <- function(x){
    ifelse(x >= 0.6 & x < 0.7, 0.7,
    ifelse(x <= 0, 0, NA))
  }
  
  for (cum in 1:length(clogasc_list)){
    cumasc <- raster(clogasc_list[cum])
    ascname <- names(cumasc)
    cumasc <- mask(cumasc, outsidemcp, inverse = TRUE)
    probbin <- calc(cumasc, fun = binprob) #creates raster layer with cell values based on the binprob function
    writeRaster(probbin, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_7_avgprob_", ascname, ".asc"), overwrite = TRUE)
    plot(probbin, png(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_7_avgprob_", ascname, ".png")), overwrite = TRUE)
    dev.off() # stops automatic saving of the plot to a png
  }
  
  
  binprob <- function(x){
    ifelse(x >= 0.7 & x < 0.8, 0.8,
    ifelse(x <= 0, 0, NA))
  }
  
  for (cum in 1:length(clogasc_list)){
    cumasc <- raster(clogasc_list[cum])
    ascname <- names(cumasc)
    cumasc <- mask(cumasc, outsidemcp, inverse = TRUE)
    probbin <- calc(cumasc, fun = binprob) #creates raster layer with cell values based on the binprob function
    writeRaster(probbin, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_8_avgprob_", ascname, ".asc"), overwrite = TRUE)
    plot(probbin, png(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_8_avgprob_", ascname, ".png")), overwrite = TRUE)
    dev.off() # stops automatic saving of the plot to a png
  }
  
  
  binprob <- function(x){
    ifelse(x >= 0.8 & x < 0.9, 0.9,
    ifelse(x <= 0, 0, NA))
  }
  
  for (cum in 1:length(clogasc_list)){
    cumasc <- raster(clogasc_list[cum])
    ascname <- names(cumasc)
    cumasc <- mask(cumasc, outsidemcp, inverse = TRUE)
    probbin <- calc(cumasc, fun = binprob) #creates raster layer with cell values based on the binprob function
    writeRaster(probbin, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_9_avgprob_", ascname, ".asc"), overwrite = TRUE)
    plot(probbin, png(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_9_avgprob_", ascname, ".png")), overwrite = TRUE)
    dev.off() # stops automatic saving of the plot to a png
  }
  
  
  binprob <- function(x){
    ifelse(x >= 0.9 & x <= 1, 1,
    ifelse(x <= 0, 0, NA))
  }
  
  for (cum in 1:length(clogasc_list)){
    cumasc <- raster(clogasc_list[cum])
    ascname <- names(cumasc)
    cumasc <- mask(cumasc, outsidemcp, inverse = TRUE)
    probbin <- calc(cumasc, fun = binprob) #creates raster layer with cell values based on the binprob function
    writeRaster(probbin, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_10_avgprob_", ascname, ".asc"), overwrite = TRUE)
    plot(probbin, png(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_binned_10_avgprob_", ascname, ".png")), overwrite = TRUE)
    dev.off() # stops automatic saving of the plot to a png
  }
}
```


get data to plot probability by depth... 
```{r}
mthord <- c("mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec")
binlst <- c(1:10)

binprob <- function(x){
  ifelse(x >0,  1,
  ifelse(x == -9999, 0, NA))
}


for (m in 1:length(mthord)){
  for (b in 1:length(binlst)){
    mth <- mthord[m]
    bin <- binlst[b]
    # mth <- "dec"
    # bin <- 1
  ascdepth <- list.files(paste0("../output/maxent/paper_plots/prob_by_depth"), pattern = paste0("^", mth, "_binned_", bin, "_avg.*asc"), full.names = TRUE)

  binaryavgstack <- stack(ascdepth)
  stackstathigh <- data.frame(matrix(ncol = 2, nrow = nlayers(binaryavgstack)))
  stackstathigh[ ,1] <- c(1:49)
  colnames(stackstathigh) <- c("asclayer", "prob_bin")
  
  for (lyr in 1:nlayers(binaryavgstack)){
    ascname <-  str_sub(ascdepth[lyr], 77, -5)
    dlay <- binaryavgstack[[lyr]]
    dlay <- calc(dlay, fun = binprob) #creates raster layer with cell values based on the binprob function
    lyrsum <- cellStats(dlay, sum)
    stackstathigh$prob_bin[lyr] <- lyrsum
    stackstathigh$asclayer[lyr] <- ascname
  
  }
  write.csv(stackstathigh, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_probbin_", bin, "_cellcount_bydepth_avg.csv"), row.names = FALSE)
  }
}

```


```{r}
mthord <- c("mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec")

for (m in 1:length(mthord)){
  mth <- mthord[m]
  probblst <- list.files(paste0("../output/maxent/paper_plots/prob_by_depth"), pattern = paste0("^", mth, "_probbin_.*.csv"), full.names = TRUE)
  a <- read.csv(probblst[1])
  b <- read.csv(probblst[2])
  c <- read.csv(probblst[3])
  d <- read.csv(probblst[4])
  e <- read.csv(probblst[5])
  f <- read.csv(probblst[6])
  g <- read.csv(probblst[7])
  h <- read.csv(probblst[8])
  i <- read.csv(probblst[9])
  j <- read.csv(probblst[10])
  
  stackstat <- cbind(a, b[ ,2], c[ ,2], d[ ,2], e[ , 2], f[ ,2], g[ ,2], h[ ,2], i[ ,2], j[ ,2])
  colnames(stackstat) <- c("depth", "0 - 0.09", "0.1 - 0.19", "0.2 - 0.29", "0.3 - 0.39", "0.4 - 0.49", "0.5 - 0.59", "0.6 - 0.69", "0.7 - 0.79", "0.8 - 0.89", ">0.9")
  stackstat <- melt(stackstat, id = "depth")
  stackstat <- stackstat[!(stackstat$depth == "1151.99"), ]
  stackstat <- stackstat[!(stackstat$depth == "1265.86"), ]
  stackstat <- stackstat[!(stackstat$depth == "1387.38"), ]
  
  colnames(stackstat) <- c("Depth", "Probability", "Cells")
  
  write.csv(stackstat, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_allprobbin_cellcount_bydepth_avg.csv"), row.names = FALSE)
}

```

think about how to get proportions... 

```{r}
mthord <- c("mar",  "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec")
cumst1 <- read.csv("../output/maxent/paper_plots/prob_by_depth/cellsperlayer.csv", header = TRUE)

for (m in 1:length(mthord)){
  mth <- mthord[m]
  a <- read.csv(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_allprobbin_cellcount_bydepth_avg.csv"), header = TRUE, stringsAsFactors=FALSE)
  for (r in 1:nrow(a)){
    # a$Depth[r] <- gsub("b_avg_cloglog_", "", x = a$Depth[r])
    # d1 <- str_sub(a$Depth[r], end = 4)
    d1 <- a$Depth[r]
	  for (ro in 1:nrow(cumst1)){
      #d2 <- str_sub(cumst1$depth[ro], end = 4)
	    d2 <- cumst1$depth[ro]
      if (d1 == d2){
          a$total_cells[r] <- cumst1$no_cells[ro]
      }
	  }
    a$p_cells[r] <- (a$Cells[r]/a$total_cells[r])*100
  }
    a$Depth <- as.numeric(a$Depth)

  write.csv(a, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_dis_prob_cells.csv"), row.names = FALSE)
}

```

histogram of probability by depth - by proportion

```{r}

bydepth <- ggplot(a, aes(Depth, p_cells, fill = Probability)) + geom_col() + scale_x_reverse() + coord_flip() #XXXXXcareful - the deeper layers aren't being displayed correctly here
plot(bydepth)
#png(paste0("../output/maxent/predictions/", mthna, "/depthplot_probavg_prop.png"))
#print(bydepth)
#dev.off()
```

ok lets try colour the probabilites to match the maps...

```{r}
probcol <- rev(brewer.pal(10,"RdYlGn"))
bydepth <- ggplot(a, aes(Depth, p_cells, fill = Probability)) + geom_col() + scale_x_reverse() + coord_flip() + scale_fill_manual(values = probcol) #XXXXXcareful - the deeper layers aren't being displayed correctly here
plot(bydepth)
```

ok now lets lump all the 0.39 and under together...


```{r}
mthord <- c("mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec")
cumst1 <- read.csv("../output/maxent/paper_plots/prob_by_depth/cellsperlayer.csv", header = TRUE)
for (m in 1:length(mthord)){
  mth <- mthord[m]
  a <- read.csv(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_dis_prob_cells.csv"), header = TRUE)
  head(a)
  d <- unique(cumst1$depth)
  x <- data.frame(matrix(nrow = length(d)))
  for (s in 1:length(d)){
    dep <- d[s]
    sd <- subset(a, Depth == dep)
    sd <- subset(sd, Probability == "0 - 0.09"| Probability == "0.1 - 0.19"| Probability == "0.2 - 0.29"| Probability == "0.3 - 0.39")
    c <- sum(sd$Cells)
    x$Depth[s] <- dep
    x$Probability[s] <- "0 - 0.39"
    x$Cells[s] <- c
    x$p_cells[s] <- 1
    x$total_cells[s] <- 1
  }
  x$Cells[is.na(x$Cells)] <- 0
   for (r in 1:nrow(x)){
     d1 <- str_sub(x$Depth[r], end = 4)
     for (ro in 1:nrow(cumst1)){
       d2 <- str_sub(cumst1$depth[ro], end = 4)
       if (d1 == d2){
           x$total_cells[r] <- cumst1$no_cells[ro]
       }
     }
   }
  for (r in 1:nrow(x)){
    x$p_cells[r] <- (x$Cells[r]/x$total_cells[r])*100
  }
x <- subset(x, select = -c(matrix.nrow...length.d..))
  write.csv(x, paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_u0.4plus_dis_prob_cells.csv"))
}
```

merge the u0.4 dataset with the original
```{r}
mthord <- c("mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec")
for (m in 1:length(mthord)){
  mth <- mthord[m]
  a <- read.csv(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_u0.4plus_dis_prob_cells.csv"), header = TRUE, stringsAsFactors=FALSE)
  a <- subset(a, select = -c(X))
  b <- read.csv(paste0("../output/maxent/paper_plots/prob_by_depth/", mth, "_dis_prob_cells.csv"), header = TRUE, stringsAsFactors=FALSE)
  c <- rbind(a, b)
  c <- c[!(c$Probability == "0 - 0.09"), ]
  c <- c[!(c$Probability == "0.1 - 0.19"), ]
  c <- c[!(c$Probability == "0.2 - 0.29"), ]
  c <- c[!(c$Probability == "0.3 - 0.39"), ]
  write.csv(c, paste0("../output//maxent/paper_plots/prob_by_depth/", mth, "_u0.4s_dis_prob_cells.csv"))
}
```



```{r}
probcol <- rev(brewer.pal(7,"RdYlGn"))
bydepth <- ggplot(c, aes(Depth, p_cells, fill = Probability)) + geom_col() + scale_x_reverse() + coord_flip() + scale_fill_manual(values = probcol) #XXXXXcareful - the deeper layers aren't being displayed correctly here
plot(bydepth)
```

ok dont forget the colours will need to match the maps so you may need to manually create your own list for whatever scheme you choose...

"1151.99"), ]
  stackstat <- stackstat[!(stackstat$depth == "1265.86"), ]
  stackstat <- stackstat[!(stackstat$depth == "1387.38"), ]
  


```{r}
mar <- read.csv("../output/maxent/paper_plots/prob_by_depth/mar_u0.4s_dis_prob_cells.csv", header = TRUE)
mar <- mar[!(mar$Depth =="1151.99" | mar$Depth =="1265.86" | mar$Depth =="1387.38"), ]
mar$Probability <- gsub(">0.9", "0.9 - 1", mar$Probability)
mar$Depth <- as.factor(mar$Depth)
flevelsmar <- levels(mar$Depth)
flevelsmar <- rev(flevelsmar)

apr <- read.csv("../output/maxent/paper_plots/prob_by_depth/apr_u0.4s_dis_prob_cells.csv", header = TRUE)
apr <- apr[!(apr$Depth =="1151.99" | apr$Depth =="1265.86" | apr$Depth =="1387.38"), ]
apr$Probability <- gsub(">0.9", "0.9 - 1", apr$Probability)
apr$Depth <- as.factor(apr$Depth)
flevelsapr <- levels(apr$Depth)
flevelsapr <- rev(flevelsapr)

may <- read.csv("../output/maxent/paper_plots/prob_by_depth/may_u0.4s_dis_prob_cells.csv", header = TRUE)
may <- may[!(may$Depth =="1151.99" | may$Depth =="1265.86" | may$Depth =="1387.38"), ]
may$Probability <- gsub(">0.9", "0.9 - 1", may$Probability)
may$Depth <- as.factor(may$Depth)
flevelsmay <- levels(may$Depth)
flevelsmay <- rev(flevelsmay)

jun <- read.csv("../output/maxent/paper_plots/prob_by_depth/jun_u0.4s_dis_prob_cells.csv", header = TRUE)
jun <- jun[!(jun$Depth =="1151.99" | jun$Depth =="1265.86" | jun$Depth =="1387.38"), ]
jun$Probability <- gsub(">0.9", "0.9 - 1", jun$Probability)
jun$Depth <- as.factor(jun$Depth)
flevelsjun <- levels(jun$Depth)
flevelsjun <- rev(flevelsjun)

jul <- read.csv("../output/maxent/paper_plots/prob_by_depth/jul_u0.4s_dis_prob_cells.csv", header = TRUE)
jul <- jul[!(jul$Depth =="1151.99" | jul$Depth =="1265.86" | jul$Depth =="1387.38"), ]
jul$Probability <- gsub(">0.9", "0.9 - 1", jul$Probability)
jul$Depth <- as.factor(jul$Depth)
flevelsjul <- levels(jul$Depth)
flevelsjul <- rev(flevelsjul)

aug <- read.csv("../output/maxent/paper_plots/prob_by_depth/aug_u0.4s_dis_prob_cells.csv", header = TRUE)
aug <- aug[!(aug$Depth =="1151.99" | aug$Depth =="1265.86" | aug$Depth =="1387.38"), ]
aug$Probability <- gsub(">0.9", "0.9 - 1", aug$Probability)
aug$Depth <- as.factor(aug$Depth)
flevelsaug <- levels(aug$Depth)
flevelsaug <- rev(flevelsaug)

sep <- read.csv("../output/maxent/paper_plots/prob_by_depth/sep_u0.4s_dis_prob_cells.csv", header = TRUE)
sep <- sep[!(sep$Depth =="1151.99" | sep$Depth =="1265.86" | sep$Depth =="1387.38"), ]
sep$Probability <- gsub(">0.9", "0.9 - 1", sep$Probability)
sep$Depth <- as.factor(sep$Depth)
flevelssep <- levels(sep$Depth)
flevelssep <- rev(flevelssep)

oct <- read.csv("../output/maxent/paper_plots/prob_by_depth/oct_u0.4s_dis_prob_cells.csv", header = TRUE)
oct <- oct[!(oct$Depth =="1151.99" | oct$Depth =="1265.86" | oct$Depth =="1387.38"), ]
oct$Probability <- gsub(">0.9", "0.9 - 1", oct$Probability)
oct$Depth <- as.factor(oct$Depth)
flevelsoct <- levels(oct$Depth)
flevelsoct <- rev(flevelsoct)

nov <- read.csv("../output/maxent/paper_plots/prob_by_depth/nov_u0.4s_dis_prob_cells.csv", header = TRUE)
nov <- nov[!(nov$Depth =="1151.99" | nov$Depth =="1265.86" | nov$Depth =="1387.38"), ]
nov$Probability <- gsub(">0.9", "0.9 - 1", nov$Probability)
nov$Depth <- as.factor(nov$Depth)
flevelsnov <- levels(nov$Depth)
flevelsnov <- rev(flevelsnov)

dec <- read.csv("../output/maxent/paper_plots/prob_by_depth/dec_u0.4s_dis_prob_cells.csv", header = TRUE)
dec <- dec[!(dec$Depth =="1151.99" | dec$Depth =="1265.86" | dec$Depth =="1387.38"), ]
dec$Probability <- gsub(">0.9", "0.9 - 1", dec$Probability)
dec$Depth <- as.factor(dec$Depth)
flevelsdec <- levels(dec$Depth)
flevelsdec <- rev(flevelsdec)

probcol <- viridisTheme(option = inferno, rev(10))


pm <- ggplot(mar, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="viridis", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsmar, breaks=flevelsmar[seq(1,length(flevelsmar), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "March") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

pa <- ggplot(apr, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="magma", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsapr, breaks=flevelsapr[seq(1,length(flevelsapr), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "April") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

pma <- ggplot(may, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="plasma", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsmay, breaks=flevelsmay[seq(1,length(flevelsmay), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "May") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

pj <- ggplot(jun, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() +  scale_fill_viridis(option="inferno", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsjun, breaks=flevelsjun[seq(1,length(flevelsjun), by = 2)]) + coord_flip() +labs(y = "% Ocean at Depth", title = "June") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0))

pju <- ggplot(jul, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="viridis", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsjul, breaks=flevelsjul[seq(1,length(flevelsjul), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "July") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

pau <- ggplot(aug, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="magma", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsaug, breaks=flevelsaug[seq(1,length(flevelsaug), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "August") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

ps <- ggplot(sep, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() +  scale_fill_viridis(option="magma", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelssep, breaks=flevelssep[seq(1,length(flevelssep), by = 2)]) + coord_flip() +labs(y = "% Ocean at Depth", title = "September") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0))

po <- ggplot(oct, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="plasma", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsoct, breaks=flevelsoct[seq(1,length(flevelsoct), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "October") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

pn <- ggplot(nov, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="viridis", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsnov, breaks=flevelsnov[seq(1,length(flevelsnov), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "November") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

pd <- ggplot(dec, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() +  scale_fill_viridis(option = "inferno", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsdec, breaks=flevelsdec[seq(1,length(flevelsdec), by = 2)]) + coord_flip() +labs(y = "% Ocean at Depth", title = "December") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0))

pm
pa
pma
pj
pju
pa
ps
po
pn
pd

```


and repeat without the 0.4 cut....

```{r}
mar <- read.csv("../output/maxent/paper_plots/prob_by_depth/mar_dis_prob_cells.csv", header = TRUE)
mar <- mar[!(mar$Depth =="1151.99" | mar$Depth =="1265.86" | mar$Depth =="1387.38"), ]
mar$Probability <- gsub(">0.9", "0.9 - 1", mar$Probability)
mar$Depth <- as.factor(mar$Depth)
flevelsmar <- levels(mar$Depth)
flevelsmar <- rev(flevelsmar)

apr <- read.csv("../output/maxent/paper_plots/prob_by_depth/apr_dis_prob_cells.csv", header = TRUE)
apr <- apr[!(apr$Depth =="1151.99" | apr$Depth =="1265.86" | apr$Depth =="1387.38"), ]
apr$Probability <- gsub(">0.9", "0.9 - 1", apr$Probability)
apr$Depth <- as.factor(apr$Depth)
flevelsapr <- levels(apr$Depth)
flevelsapr <- rev(flevelsapr)

may <- read.csv("../output/maxent/paper_plots/prob_by_depth/may_dis_prob_cells.csv", header = TRUE)
may <- may[!(may$Depth =="1151.99" | may$Depth =="1265.86" | may$Depth =="1387.38"), ]
may$Probability <- gsub(">0.9", "0.9 - 1", may$Probability)
may$Depth <- as.factor(may$Depth)
flevelsmay <- levels(may$Depth)
flevelsmay <- rev(flevelsmay)

jun <- read.csv("../output/maxent/paper_plots/prob_by_depth/jun_dis_prob_cells.csv", header = TRUE)
jun <- jun[!(jun$Depth =="1151.99" | jun$Depth =="1265.86" | jun$Depth =="1387.38"), ]
jun$Probability <- gsub(">0.9", "0.9 - 1", jun$Probability)
jun$Depth <- as.factor(jun$Depth)
flevelsjun <- levels(jun$Depth)
flevelsjun <- rev(flevelsjun)

jul <- read.csv("../output/maxent/paper_plots/prob_by_depth/jul_dis_prob_cells.csv", header = TRUE)
jul <- jul[!(jul$Depth =="1151.99" | jul$Depth =="1265.86" | jul$Depth =="1387.38"), ]
jul$Probability <- gsub(">0.9", "0.9 - 1", jul$Probability)
jul$Depth <- as.factor(jul$Depth)
flevelsjul <- levels(jul$Depth)
flevelsjul <- rev(flevelsjul)

aug <- read.csv("../output/maxent/paper_plots/prob_by_depth/aug_dis_prob_cells.csv", header = TRUE)
aug <- aug[!(aug$Depth =="1151.99" | aug$Depth =="1265.86" | aug$Depth =="1387.38"), ]
aug$Probability <- gsub(">0.9", "0.9 - 1", aug$Probability)
aug$Depth <- as.factor(aug$Depth)
flevelsaug <- levels(aug$Depth)
flevelsaug <- rev(flevelsaug)

sep <- read.csv("../output/maxent/paper_plots/prob_by_depth/sep_dis_prob_cells.csv", header = TRUE)
sep <- sep[!(sep$Depth =="1151.99" | sep$Depth =="1265.86" | sep$Depth =="1387.38"), ]
sep$Probability <- gsub(">0.9", "0.9 - 1", sep$Probability)
sep$Depth <- as.factor(sep$Depth)
flevelssep <- levels(sep$Depth)
flevelssep <- rev(flevelssep)

oct <- read.csv("../output/maxent/paper_plots/prob_by_depth/oct_dis_prob_cells.csv", header = TRUE)
oct <- oct[!(oct$Depth =="1151.99" | oct$Depth =="1265.86" | oct$Depth =="1387.38"), ]
oct$Probability <- gsub(">0.9", "0.9 - 1", oct$Probability)
oct$Depth <- as.factor(oct$Depth)
flevelsoct <- levels(oct$Depth)
flevelsoct <- rev(flevelsoct)

nov <- read.csv("../output/maxent/paper_plots/prob_by_depth/nov_dis_prob_cells.csv", header = TRUE)
nov <- nov[!(nov$Depth =="1151.99" | nov$Depth =="1265.86" | nov$Depth =="1387.38"), ]
nov$Probability <- gsub(">0.9", "0.9 - 1", nov$Probability)
nov$Depth <- as.factor(nov$Depth)
flevelsnov <- levels(nov$Depth)
flevelsnov <- rev(flevelsnov)

dec <- read.csv("../output/maxent/paper_plots/prob_by_depth/dec_dis_prob_cells.csv", header = TRUE)
dec <- dec[!(dec$Depth =="1151.99" | dec$Depth =="1265.86" | dec$Depth =="1387.38"), ]
dec$Probability <- gsub(">0.9", "0.9 - 1", dec$Probability)
dec$Depth <- as.factor(dec$Depth)
flevelsdec <- levels(dec$Depth)
flevelsdec <- rev(flevelsdec)

probcol <- viridisTheme(option = inferno, rev(10))


pm <- ggplot(mar, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="viridis", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsmar, breaks=flevelsmar[seq(1,length(flevelsmar), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "March") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

pa <- ggplot(apr, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="magma", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsapr, breaks=flevelsapr[seq(1,length(flevelsapr), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "April") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

pma <- ggplot(may, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="plasma", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsmay, breaks=flevelsmay[seq(1,length(flevelsmay), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "May") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

pj <- ggplot(jun, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() +  scale_fill_viridis(option="inferno", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsjun, breaks=flevelsjun[seq(1,length(flevelsjun), by = 2)]) + coord_flip() +labs(y = "% Ocean at Depth", title = "June") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0))

pju <- ggplot(jul, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="viridis", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsjul, breaks=flevelsjul[seq(1,length(flevelsjul), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "July") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

pau <- ggplot(aug, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="magma", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsaug, breaks=flevelsaug[seq(1,length(flevelsaug), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "August") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

ps <- ggplot(sep, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() +  scale_fill_viridis(option="magma", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelssep, breaks=flevelssep[seq(1,length(flevelssep), by = 2)]) + coord_flip() +labs(y = "% Ocean at Depth", title = "September") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0))

po <- ggplot(oct, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="plasma", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsoct, breaks=flevelsoct[seq(1,length(flevelsoct), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "October") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

pn <- ggplot(nov, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() + scale_fill_viridis(option="viridis", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsnov, breaks=flevelsnov[seq(1,length(flevelsnov), by = 2)], ) + coord_flip() + labs(y = "% Ocean at Depth", title = "November") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0)) 

pd <- ggplot(dec, aes(Depth, p_cells, fill = Probability)) + geom_col(width = 1) + coord_flip() +  scale_fill_viridis(option = "inferno", discrete = TRUE, direction = -1) + scale_x_discrete(limits = flevelsdec, breaks=flevelsdec[seq(1,length(flevelsdec), by = 2)]) + coord_flip() +labs(y = "% Ocean at Depth", title = "December") + theme_half_open(12) + theme(plot.margin = margin(6, 0, 6, 0))

pm
pa
pma
pj
pju
pa
ps
po
pn
pd

```

now MJ suggested to only show some depths (the most commonly predicted ones) NOTE DECIDED MAYBE NOT GOOD BECAUSE OF NEW GRAPHIC PLUS DEPTH CHANGES


```{r}
probblst <- list.files("../output/maxent/paper_plots/prob_by_depth/", pattern = "_u0.4s_dis_prob_cells.csv", full.names = TRUE)
a <- read.csv(probblst[1])
b <- read.csv(probblst[2])
c <- read.csv(probblst[3])
d <- read.csv(probblst[4])
e <- read.csv(probblst[5])
f <- read.csv(probblst[6])
g <- read.csv(probblst[7])
h <- read.csv(probblst[8])
i <- read.csv(probblst[9])
j <- read.csv(probblst[10])
  
stackstat <- cbind(a, b[ ,4], c[ ,4], d[ ,4], e[ ,4], f[ ,4], g[ ,4], h[ ,4], i[ ,4], j[ ,4])

colnames(stackstat)

x <- subset(stackstat, select = -c(X, p_cells))
x <- x[ , c(1, 2, 4, 3, 5:13)]
for (r in 1:nrow(x)){
x$totalm[r] <- rowSums(x[r, 4:13])
x$totala[r] <- x$total_cells[r]*10
x$p_cells[r] <- (x$totalm[r]/x$totala[r])*100
}
y <- subset(x, select = c(Depth, Probability, p_cells))
y$Probability <- gsub(">0.9", "0.9 - 1", y$Probability)

probcol <- rev(brewer.pal(7,"RdYlGn"))
bydepth <- ggplot(y, aes(Depth, p_cells, fill = Probability)) + geom_col() + scale_x_reverse() + coord_flip() + scale_fill_manual(values = probcol) 
plot(bydepth)

z <- subset(y, Depth <510)

bydepth <- ggplot(z, aes(Depth, p_cells, fill = Probability)) + geom_bar(stat = "identity") + coord_flip() + scale_x_reverse() + scale_fill_manual(values = probcol) + theme_minimal() #still missing data...
plot(bydepth)

```

```{r}
z <- subset(y, Depth <510)
z <- z[order(z$Depth), ]

y$Depth <- as.factor(y$Depth)
flevels <- levels(y$Depth)
flevels <- rev(flevels)

ggplot(y, aes(Depth, p_cells, fill = Probability)) + geom_col() + coord_flip() +  scale_fill_manual(values = probcol) + scale_x_discrete(limits = flevels, breaks=flevels[seq(1,length(flevels), by = 2)]) + coord_flip()


```

#2d hotspot maps

first create layers that are 0.5 and above

```{r habitat classification on probability - >0.5}

binprob <- function(x){
  ifelse(x >= 0.5, 1,
  ifelse(x < 0.5, 0, NA)) 
}

mthord <- c("mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec")

for (m in 1:length(mthord)){
  mthna <- mthord[m]
  clogasc_list <- list.files(paste0("../output/maxent/predictions/", mthna), pattern = "^avg_cloglog_.*asc", full.names = TRUE)
  for (cum in 1:length(clogasc_list)){
    cumasc <- raster(clogasc_list[cum])
    ascname <- names(cumasc)
    ascname <- gsub("avg_cloglog_", "", ascname)
    probbin <- calc(cumasc, fun = binprob) #creates raster layer with cell values based on the binprob function
    writeRaster(probbin, paste0("../output/maxent/paper_plots/hotspot_mapping/", mthna,  "_binary_0.5_", ascname, ".asc"), overwrite = TRUE)
     plot(probbin, png(paste0("../output/maxent/paper_plots/hotspot_mapping/", mthna, "_binary_0.5_", ascname, ".png")), overwrite = TRUE)
       dev.off() # stops automatic saving of the plot to a png
  }
}

```

then create an summary map....
```{r >0.5 prob monthly 2D representation}
mthord <- c("mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec")

for (m in 1:length(mthord)){
  mthna <- mthord[m]
  binaryprob_list <- list.files(paste0("../output/maxent/paper_plots/hotspot_mapping/"), pattern = paste0(mthna, "*_binary_0.5_.*.asc$"), full.names = TRUE)
  binstack <- stack(binaryprob_list)
  stacksum <- sum(binstack, na.rm = TRUE)
  writeRaster(stacksum, paste0("../output/maxent/paper_plots/hotspot_mapping/", mthna, "_bin_0.5_2d.asc"), overwrite=TRUE)
  plot(stacksum, png(paste0("../output/maxent/paper_plots/hotspot_mapping/", mthna, "_bin_0.5_2d.png")))
  dev.off()
}

```

now create summary maps where values are binary - not counts of cells
```{r}
binprob <- function(x){
  ifelse(x > 0, 1,
  ifelse(x <= 0, 0, NA))
}

  clogasc_list <- list.files("../output/maxent/paper_plots/hotspot_mapping", pattern = "*_bin_0.5_2d.asc", full.names = TRUE)
  for (cum in 1:length(clogasc_list)){
    cumasc <- raster(clogasc_list[cum])
    ascname <- names(cumasc)
    probbin <- calc(cumasc, fun = binprob) #creates raster layer with cell values based on the binprob function
    writeRaster(probbin, paste0("../output/maxent/paper_plots/hotspot_mapping/", ascname, "_single.asc"), overwrite = TRUE)
    plot(probbin, png(paste0("../output/maxent/paper_plots/hotspot_mapping/", ascname, "_single.png")), overwrite = TRUE)
    dev.off() # stops automatic saving of the plot to a png
  }
```

then plot the maps

```{r}

s <- shapefile("../data/env/landp/landpro.shp") #made in arcgis
acrs <- aea@crs
mcp <- shapefile("../output/bio/minimum_convex_poly/mcp_capelin_100_poly.shp")
ss <- raster::intersect(s, mcp)  #trim to mcp


mar2d <- raster("../output/maxent/paper_plots/hotspot_mapping/mar_bin_0.5_2d_single.asc")
apr2d <- raster("../output/maxent/paper_plots/hotspot_mapping/apr_bin_0.5_2d_single.asc")
may2d <- raster("../output/maxent/paper_plots/hotspot_mapping/may_bin_0.5_2d_single.asc")
jun2d <- raster("../output/maxent/paper_plots/hotspot_mapping/jun_bin_0.5_2d_single.asc")
jul2d <- raster("../output/maxent/paper_plots/hotspot_mapping/jul_bin_0.5_2d_single.asc")
aug2d <- raster("../output/maxent/paper_plots/hotspot_mapping/aug_bin_0.5_2d_single.asc")
sep2d <- raster("../output/maxent/paper_plots/hotspot_mapping/sep_bin_0.5_2d_single.asc")
oct2d <- raster("../output/maxent/paper_plots/hotspot_mapping/oct_bin_0.5_2d_single.asc")
nov2d <- raster("../output/maxent/paper_plots/hotspot_mapping/nov_bin_0.5_2d_single.asc")
dec2d <- raster("../output/maxent/paper_plots/hotspot_mapping/dec_bin_0.5_2d_single.asc")

#trim to mcp
mar2d <- raster::mask(mar2d, mcp)
apr2d <- raster::mask(apr2d, mcp)
may2d <- raster::mask(may2d, mcp)
jun2d <- raster::mask(jun2d, mcp)
jul2d <- raster::mask(jul2d, mcp)
aug2d <- raster::mask(aug2d, mcp)
sep2d <- raster::mask(sep2d, mcp)
oct2d <- raster::mask(oct2d, mcp)
nov2d <- raster::mask(nov2d, mcp)
dec2d <- raster::mask(dec2d, mcp)

#add crs
mar2d@crs <- acrs
apr2d@crs <- acrs
may2d@crs <- acrs
jun2d@crs <- acrs
jul2d@crs <- acrs
aug2d@crs <- acrs
sep2d@crs <- acrs
oct2d@crs <- acrs
nov2d@crs <- acrs
dec2d@crs <- acrs

#ratify to categorical
mar2d <- ratify(mar2d)
rat <- levels(mar2d)[[1]]
rat$suitability <- c("< 0.5", "> 0.5")
levels(mar2d) <- rat
apr2d <- ratify(apr2d)
rat <- levels(apr2d)[[1]]
rat$suitability <- c("< 0.5", "> 0.5")
levels(apr2d) <- rat
may2d <- ratify(may2d)
rat <- levels(may2d)[[1]]
rat$suitability <- c("< 0.5", "> 0.5")
levels(may2d) <- rat
jun2d <- ratify(jun2d)
rat <- levels(jun2d)[[1]]
rat$suitability <- c("< 0.5", "> 0.5")
levels(jun2d) <- rat
jul2d <- ratify(jul2d)
rat <- levels(jul2d)[[1]]
rat$suitability <- c("< 0.5", "> 0.5")
levels(jul2d) <- rat
aug2d <- ratify(aug2d)
rat <- levels(aug2d)[[1]]
rat$suitability <- c("< 0.5", "> 0.5")
levels(aug2d) <- rat
sep2d <- ratify(sep2d)
rat <- levels(sep2d)[[1]]
rat$suitability <- c("< 0.5", "> 0.5")
levels(sep2d) <- rat
oct2d <- ratify(oct2d)
rat <- levels(oct2d)[[1]]
rat$suitability <- c("< 0.5", "> 0.5")
levels(oct2d) <- rat
nov2d <- ratify(nov2d)
rat <- levels(nov2d)[[1]]
rat$suitability <- c("< 0.5", "> 0.5")
levels(nov2d) <- rat
dec2d <- ratify(dec2d)
rat <- levels(dec2d)[[1]]
rat$suitability <- c("< 0.5", "> 0.5")
levels(dec2d) <- rat

maplst <- list(mar2d, apr2d, may2d, jun2d, jul2d, aug2d, sep2d, oct2d, nov2d, dec2d)

pstack <- stack(maplst)

# my.at <- seq(0, 1, by = 0.1)
# mapTheme <- infernoTheme(region = rev(inferno(10)))


p <- levelplot(pstack, col.regions=c('white', 'red'), ylab = NULL, xlab = NULL, scales=list(draw=FALSE), layout = c(5, 2), names.attr = c("Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"), margin = FALSE) + latticeExtra::layer(sp.polygons(ss, fill = "dark grey", col = "transparent"))+ latticeExtra::layer(sp.polygons(mcp, col = "dark grey"))
plot(p)
```

now create a table to see how many cells there are >0.5 in each month

```{r count cells >0.5}

binaryprob_list <- list.files("../output/maxent/paper_plots/hotspot_mapping/", pattern = ".*_bin_0.5_2d.asc", full.names = TRUE)
sum2d <- setNames(data.frame(matrix(ncol = 2, nrow = binl)), c("month", "count"))


for (r in 1:length(binaryprob_list)){
  ras <- raster(binaryprob_list[r])
  rnm <- names(ras)
  sum2d$month[r] <- gsub("_bin_0.5_2d", "", x = rnm)
  sum2d$count[r] <- cellStats(ras, sum, asSample = TRUE)
}

#order table from march to december
mthord <- c("mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec")
sum2d <- sum2d[match(mthord, sum2d$month), ]

#get proportion
tcs <- read.csv("../output/maxent/paper_plots/prob_by_depth/cellsperlayer.csv", header = TRUE) #file showing how many cells per depth
tcs <- tcs[-c(1:3), ] #because the top three rows are deeper than the capelin obs...
totc <- sum(tcs$no_cells)

for (r in 1:nrow(sum2d)){
  sum2d$proportion[r] <- (sum2d$count[r]/totc)
}

write.csv(sum2d, "../output/maxent/paper_plots/cell_count_0.5.csv", row.names = FALSE)


```


#probabilty maps (selected)

xxxx
```{r}
library(raster)
library(rgdal)
library(rasterVis)
library(colorspace)

aea <- raster("../output/env/aea.tif") #the correct CRS
s <- shapefile("../data/env/landp/landpro.shp") #made in arcgis
acrs <- aea@crs
mcp <- shapefile("../output/bio/minimum_convex_poly/mcp_capelin_100_poly.shp")
ss <- raster::intersect(s, mcp)  #trim land file to mcp



mar2d <- raster("../output/maxent/paper_plots/hotspot_mapping/mar_bin_0.5_2d_single.asc")
apr2d <- raster("../output/maxent/paper_plots/hotspot_mapping/apr_bin_0.5_2d_single.asc")
may2d <- raster("../output/maxent/paper_plots/hotspot_mapping/may_bin_0.5_2d_single.asc")
jun2d <- raster("../output/maxent/paper_plots/hotspot_mapping/jun_bin_0.5_2d_single.asc")
jul2d <- raster("../output/maxent/paper_plots/hotspot_mapping/jul_bin_0.5_2d_single.asc")
aug2d <- raster("../output/maxent/paper_plots/hotspot_mapping/aug_bin_0.5_2d_single.asc")
sep2d <- raster("../output/maxent/paper_plots/hotspot_mapping/sep_bin_0.5_2d_single.asc")
oct2d <- raster("../output/maxent/paper_plots/hotspot_mapping/oct_bin_0.5_2d_single.asc")
nov2d <- raster("../output/maxent/paper_plots/hotspot_mapping/nov_bin_0.5_2d_single.asc")
dec2d <- raster("../output/maxent/paper_plots/hotspot_mapping/dec_bin_0.5_2d_single.asc")

#trim to mcp
mar2d <- raster::mask(mar2d, mcp)
apr2d <- raster::mask(apr2d, mcp)
may2d <- raster::mask(may2d, mcp)
jun2d <- raster::mask(jun2d, mcp)
jul2d <- raster::mask(jul2d, mcp)
aug2d <- raster::mask(aug2d, mcp)
sep2d <- raster::mask(sep2d, mcp)
oct2d <- raster::mask(oct2d, mcp)
nov2d <- raster::mask(nov2d, mcp)
dec2d <- raster::mask(dec2d, mcp)

#add crs
mar2d@crs <- acrs
apr2d@crs <- acrs
may2d@crs <- acrs
jun2d@crs <- acrs
jul2d@crs <- acrs
aug2d@crs <- acrs
sep2d@crs <- acrs
oct2d@crs <- acrs
nov2d@crs <- acrs
dec2d@crs <- acrs





maplst <- list.files("../output/maxent/predictions/may", pattern = "^avg_clog.*.asc", full.names = TRUE)
maplst2 <- list.files("../output/maxent/predictions/sep", pattern = "^avg_clog.*.asc", full.names = TRUE)
brk <- seq(0, 1, 0.1) #for legend
lgc <- sequential_hcl(10, palette = "YlOrRd") #colour scheme from colorspace package
outsidemcp <- shapefile("../data/env/landp/mcpout.shp") #made in arcgis

pras6 <- raster(maplst[37])
pras180 <- raster(maplst[14])
pras370 <- raster(maplst[28])
pras697 <- raster(maplst[41])
p2ras6 <- raster(maplst2[37])
p2ras180 <- raster(maplst2[14])
p2ras370 <- raster(maplst2[28])
p2ras697 <- raster(maplst2[41])
crs(pras6) <- apr
crs(pras180) <- apr
crs(pras370) <- apr
crs(pras697) <- apr
crs(p2ras6) <- apr
crs(p2ras180) <- apr
crs(p2ras370) <- apr
crs(p2ras697) <- apr
ascname6 <- names(pras6)
ascname180 <- names(pras180)
ascname370 <- names(pras370)
ascname697 <- names(pras697)
a2scname6 <- names(p2ras6)
a2scname180 <- names(p2ras180)
a2scname370 <- names(p2ras370)
a2scname697 <- names(p2ras697)

# pstack <- stack(pras6, pras180, pras370, pras697) #stack the layers
# 
# pras1 <- raster(maplst[1])
# pras2 <- raster(maplst[2])
# pras3 <- raster(maplst[3])
# pras4 <- raster(maplst[4])
# crs(pras1) <- apr
# crs(pras2) <- apr
# crs(pras3) <- apr
# crs(pras4) <- apr

pstack <- stack(pras6, pras180, pras370, pras697, p2ras6, p2ras180, p2ras370, p2ras697) #stack the layers

cls <- c("6m", "180m", "370m", "697m")
rws <- c("May", "Sep")
mapTheme <- rasterTheme(region = rev(brewer.pal(10,"RdYlGn")))
my.at <- seq(0, 1, by = 0.1)


p <- levelplot(pstack, ylab = NULL, xlab = NULL, scales=list(draw=FALSE), colorkey=list(space="bottom", at = my.at), par.settings = mapTheme, layout = c(4, 2), names.attr = c("6m", "180m", "370m", "697m", "", "", "", ""), margin = FALSE)
p + layer(sp.polygons(s, fill = "black")) + layer (sp.polygons(outsidemcp, fill = redtrans, col = NA))


#dev.copy(png, (paste0("../output/maxent/predictions/testplots/rasterVis.png")), width = 1920,height = 1080)
#dev.off() # stops automatic saving of the plot to a png))



```






#coloured histograms

```{r}
mar <- raster("../output/maxent/predictions/mar/avg_cloglog_97.0413.asc")
#apr <- raster("../output/maxent/predictions/apr/avg_cloglog_97.0413.asc")

mardf <- as.data.frame(mar) #convert raster to dataframe
mardf <- na.omit(mardf) #remove all the land 
for (i in 1:nrow(mardf)){
  if (mardf$avg_cloglog_97.0413[i] <=0.1){
    mardf$bin[i] <- 1
  } else if (mardf$avg_cloglog_97.0413[i] >0.1 & mardf$avg_cloglog_97.0413[i] <= 0.2){
      mardf$bin[i] <- 2
  } else if (mardf$avg_cloglog_97.0413[i] >0.2 & mardf$avg_cloglog_97.0413[i] <= 0.3){
      mardf$bin[i] <- 3
  } else if (mardf$avg_cloglog_97.0413[i] >0.3 & mardf$avg_cloglog_97.0413[i] <= 0.4){
      mardf$bin[i] <- 4
  } else if (mardf$avg_cloglog_97.0413[i] >0.4 & mardf$avg_cloglog_97.0413[i] <= 0.5){
      mardf$bin[i] <- 5
  } else if (mardf$avg_cloglog_97.0413[i] >0.5 & mardf$avg_cloglog_97.0413[i] <= 0.6){
      mardf$bin[i] <- 6
  } else if (mardf$avg_cloglog_97.0413[i] >0.6 & mardf$avg_cloglog_97.0413[i] <= 0.7){
      mardf$bin[i] <- 7
  } else if (mardf$avg_cloglog_97.0413[i] >0.7 & mardf$avg_cloglog_97.0413[i] <= 0.8){
      mardf$bin[i] <- 8
  } else if (mardf$avg_cloglog_97.0413[i] >0.8 & mardf$avg_cloglog_97.0413[i] <= 0.9){
      mardf$bin[i] <- 9
  } else if (mardf$avg_cloglog_97.0413[i] >0.9){
      mardf$bin[i] <- 10
  }
}

mardf$bin <- as.factor(mardf$bin)

brk <- seq(0.1, 1, 0.1) #bins you want
brkl <- as.character(brk)


p <- ggplot(mardf, aes(x = avg_cloglog_97.0413, fill = bin))+ geom_histogram(breaks = brk) + theme_classic() + scale_fill_viridis_d(option = "inferno", direction = -1) + theme(legend.position = "none", plot.title = element_blank(), axis.title.x = element_blank(), axis.title.y = element_blank()) + scale_x_continuous(breaks=seq(0,1,0.1))
png("../output/maxent/paper_plots/histogram_mar_97.png", height = 1024, width = 1024)
p
dev.off()

```


# variable maps
- temp
- chl 
- o2
- sal
- 4 different months
- relationship of variables to each other
- pick a depth (say the 11.7737 m)

months are mar, jun, sep, dec
pick 3 diff years say 1998, 2006, 2013

```{r}
aea <- raster("../output/env/aea.tif") #the correct CRS
s <- shapefile("../data/env/landp/landpro.shp") #made in arcgis
acrs <- aea@crs
mcp <- shapefile("../output/bio/minimum_convex_poly/mcp_capelin_100_poly.shp")
ss <- raster::intersect(s, mcp)  #trim land file to mcp

yrlst <- c("1998", "2006", "2013")
mthlst <- c("03", "06", "09", "12")
varlst <- c("temp", "salinity", "o2")

for (y in 1:length(yrlst)){
  yr <- yrlst[y]
  fdr <- paste0("../data/env/ascii/ascii", yr, "/")
  for (m in 1:length(mthlst)){
    mt <- mthlst[m]
    for (v in 1:length(varlst)){
      var <- varlst[v]
      ras <- raster(paste0(fdr, yr, "_", mt, "_", var, ".nc_11.7737.asc"))
      lyrnm <- names(ras)
      crs(ras) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"
      ras <- projectRaster(ras, aea)
      ras <- raster::mask(ras, mcp)
      
      p <- levelplot(ras, margin=FALSE, colorkey=list(space='bottom', axis.line=list(col='black')), par.settings=list(axis.line=list(col='transparent')), scales=list(draw=FALSE), col.regions=colorRampPalette(blue2red(20))) + layer(sp.polygons(ss, fill = "dark grey", col = "transparent"))
              
      png(paste0("../output/maxent/paper_plots/", lyrnm, ".png"), height = 1024, width = 1024)
      print(p)
      dev.off()
    }
  }
}

#chl is done seperately as it is surface

yrlst <- c("1998", "2006", "2013")
mthlst <- c("03", "06", "09", "12")
varlst <- c("chl")

for (y in 1:length(yrlst)){
  yr <- yrlst[y]
  fdr <- paste0("../data/env/ascii/ascii", yr, "/")
  for (m in 1:length(mthlst)){
    mt <- mthlst[m]
    for (v in 1:length(varlst)){
      var <- varlst[v]
      ras <- raster(paste0(fdr, yr, "_", mt, "_", var, ".nc_0.50576.asc"))
      lyrnm <- names(ras)
      crs(ras) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"
      ras <- projectRaster(ras, aea)
      ras <- raster::mask(ras, mcp)
      
      p <- levelplot(ras, margin=FALSE, colorkey=list(space='bottom', axis.line=list(col='black')), par.settings=list(axis.line=list(col='transparent')), scales=list(draw=FALSE), col.regions=colorRampPalette(blue2red(20))) + layer(sp.polygons(ss, fill = "dark grey", col = "transparent"))
              
      png(paste0("../output/maxent/paper_plots/", lyrnm, ".png"), height = 1024, width = 1024)
      print(p)
      dev.off()
    }
  }
}
```

#boxplots of env variables - part 2

```{r}
library(ggplot2)
library(gridExtra)
library(dplyr)

presab <- read.csv("../output/bio/presab_nafo_yr.csv", header = TRUE)
background <- subset(presab, occurrence == "0")

background <- filter(background, month !=1) #remove jan
background <- filter(background, month !=2) #remove feb


background$month <- factor(background$month) # converts month to a categorical variable

```

```{r}
box_temp <- ggplot(data = background, aes(x = month, y = temp_depth)) + geom_boxplot() + xlab("Month") + ylab("Temperature (Kelvin)") + theme_classic()

box_chl <- ggplot(data = background, aes(x = month, y = chl_surface)) + geom_boxplot() + xlab("Month") + ylab("Chlorophyll Concentration (mmol.m-3)") + theme_classic()

box_o2 <- ggplot(data = background, aes(x = month, y = o2_depth)) + geom_boxplot() + xlab("Month") + ylab("Dissolved Oxygen (mmol.m-3)") + theme_classic()

box_sal <- ggplot(data = background, aes(x = month, y = salinity_depth)) + geom_boxplot() + xlab("Month") + ylab("Salinity Concentration (PSU)") + theme_classic()

box_naos <- ggplot(data = background, aes(x = month, y = nao_sample)) + geom_boxplot() + xlab("Month") + ylab("NAO (Sampling Month)") + theme_classic()

box_amos <- ggplot(data = background, aes(x = month, y = amo_sample)) + geom_boxplot() + xlab("Month") + ylab("AMO (Sampling Month)") + theme_classic()

box_naop <- ggplot(data = background, aes(x = month, y = nao_prev)) + geom_boxplot() + xlab("Month") + ylab("NAO (Previous Month)") + theme_classic()

box_naow <- ggplot(data = background, aes(x = month, y = nao_winter)) + geom_boxplot() + xlab("Month") + ylab("NAO (Winter)") + theme_classic()

box_amow <- ggplot(data = background, aes(x = month, y = amo_winter)) + geom_boxplot() + xlab("Month") + ylab("AMO (Winter)") + theme_classic()


box_all <- grid.arrange(box_chl, box_o2, box_sal, box_temp, ncol=2)
ggsave("../output/maxent/paper_plots/env_boxplots.png", plot = box_all, device = png(), dpi = 400)

box_osc <- grid.arrange(box_naos, box_amos, box_naow, box_amow, box_naop, ncol = 3)
ggsave("../output/maxent/paper_plots/env_boxplots_osc.png", plot = box_osc, device = png(), dpi = 400)

box_aos <- grid.arrange(box_chl, box_o2, box_sal, box_temp,box_naos, box_amos, box_naow, box_amow, box_naop, ncol = 3)
ggsave("../output/maxent/paper_plots/env_boxplots_allos.png", plot = box_aos, device = png(), dpi = 400)

```

