---
title: "maxent model avec xvalidation"
author: "Samantha Andrews"
output: html_notebook
---

# Overview
A note to anyone who might happen to stumble across this... I am a beginner in R and have had no exposure to similar languages. I don't know what I'm doing. The code herein is unlikely to be elegant and there area probably more efficient ways of running the code.

Built with 'r getRversion()'..

# Package dependencies
You can install and load them using the following code which uses a function called [ipak](https://gist.github.com/stevenworthington/3178163). Note this function checks to see if the packages are installed first before loading.


```{r pre-install & load packages, include=FALSE}
packages <- c("dismo", "stringr")
source("../src/ipak.R")
ipak(packages)
```


#load the presence-background dataset 
("../output/bio/presab_nafo_yr.csv")

```{r load pres-background dataset}
presback <- read.csv("../output/bio/presab_nafo_yr.csv", header = TRUE)
colnames(presback)
```

this dataset contains a lot of columns you don't need for the maxent models. Remove them here

```{r remove unnecessary columns}
presback <- subset(presback, select = -c(cell_id, id, decimalLatitude, decimalLongitude, datecollected, institutioncode, individualcount, depth, resname, originalscientificname, collectioncode, day, nafo_zone, gear, longitude_meters, latitude_meters, total_cell_obs_xy, total_cell_obs_xyt, bottom_depth, XXtotal_cell_obs_xyzt, temp_celsius_depth, temp_celsius_surface, longitude_meters.1, latitude_meters.1, bottom_depth_glorys, longitude_meters.2, latitude_meters.2, cell_id_3d, total_cell_obs_xyzt, cell_id_xyzt))
colnames(presback)
```

#monthly model data selection and prep
For each monthly model, subset the data to the month you want, and the variables you want (Based on spearmans and VIF)

jan variables to keep: temp_depth, salinty_depth, o2_depth, chl_surface, nao_sample, nao_winter 
```{r january data}
janprback <- subset(presback, month == "1")
janprback <- subset(janprback, select = c(occurrence, year, temp_depth, salinity_depth, o2_depth, chl_surface, nao_sample, nao_winter))
```

now each month contains NAs - lets remove these (maxent principle doesnt allow for missing data - http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.15.5607&rep=rep1&type=pdf)

```{r jan remove na vals}
janprback <- janprback[!is.na(janprback$temp_depth), ]
janprback <- janprback[!is.na(janprback$salinity_depth), ]
janprback <- janprback[!is.na(janprback$o2_depth), ]
janprback <- janprback[!is.na(janprback$chl_surface), ]
janprback <- janprback[!is.na(janprback$nao_sample), ]
janprback <- janprback[!is.na(janprback$nao_winter), ]
```


normal model..
mod12 <- maxent(x = prab, p = pa, file = .asc, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE")) 
mod12

```{r train and test on 2003 inc AIC for reg val}
timeslice <- "jan2003"
yr <- str_sub(timeslice, -4)
train <- subset(janprback, year != yr)
trainpa <- train$occurrence
test <-  subset(janprback, year == yr)
testp <- subset(test, occurrence == "1")
testp <- subset(testp, select = -c(year, occurrence))
testb <- subset(test, occurrence == "0")
testb <- subset(testb, select = -c(year, occurrence))
train  <- subset(train, select = -c(year, occurrence))

AIClist <- read.csv("../data/env/AICcCalculations.csv", header = TRUE)

#netam = 0.25
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=0.25"))

#now based on glover-kapfer pdf with excel manual + https://esajournals.onlinelibrary.wiley.com/doi/full/10.1890/10-1171.1.... lets try automate some of this.. 

#count number of non-zero coefficients, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"), header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

#betamval <- 0.50
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=0.50"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"))
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)


for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 0.75
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=0.75"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"))
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 1
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=1"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"))
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 1.25
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=1.25"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"))
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 1.50
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=1.5"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"))
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 1.75
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=1.75"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"))
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 2
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=2"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"))
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 2.25
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=2.25"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"))
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 2.50
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=2.5"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"))
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 2.75
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=2.75"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv")
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 3
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=3"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv")
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 3.25
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=3.25"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"))
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 3.50
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=3.5"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"))
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 3.75
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=3.75"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"))
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 4
mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "betamultiplier=4"))



#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv(paste0("../output/maxent/models/", timeslice, "/species.lambdas"), header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv(paste0("../output/maxent/models/", timeslice, "/maxentResults.csv"))
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv(paste0("../output/maxent/models/", timeslice, "/species_samplePredictions.csv"), header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

AIClist$AIC <- ((2*AIClist$coefficients)-(2*AIClist$sum.of.logs))
AIClist$AICc <- (-2*(AIClist$sum.of.logs)+((2*AIClist$coefficients)*(AIClist$n/(AIClist$n - AIClist$coefficients-1))))

write.csv(AIClist, paste0("../output/maxent/models/", timeslice, "/AICforMaxentReg.csv"), row.names = FALSE)

```

``





mod <- maxent(x = train, p = trainpa, path = paste0("../output/maxent/models/", timeslice), args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE"))
mod



# this is after beta has been selected for
ev <- evaluate(p = testp, a= testb, model = mod)
str(ev)
auc <- ev@auc
cor <- ev@cor
evaluation <- cbind(auc, cor)
write.csv(evaluation, paste0("../output/maxent/models/", timeslice, "/eval.csv"), row.names = FALSE) 
thres <- threshold(ev)
write.csv(thres, paste0("../output/maxent/models/", timeslice, "/threshold.csv"), row.names = FALSE)
```






