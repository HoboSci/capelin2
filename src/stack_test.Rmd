This works

need raster rgdal netcdf4 tidyr

```{r}
ascname <- list.files("../data/jan_test_86.9/", pattern = "*.asc", full.names = TRUE)    # this folder currently contains other dummy files. its just a test to automate stacks
rasters <- lapply(paste0(ascname), raster)  


year <- "X1998"
month <- "01"
depth <- "86.9294"
tempvar <- "temp"
chlvar <- "chl"
o2var <- "o2"
salvar <- "salinity"
depthvar <- "depth"
surfacevar <- "surface"
naovar <- "nao"
amovar <- "amo"
samplevar <- "sample"
wintervar <- "winter"
  
for (i in 1:length(rasters)){
  ascyear <- (sapply(strsplit(names(rasters[[i]]), "_"), "[[", 1))
  ascmonth <- (sapply(strsplit(names(rasters[[i]]), "_"), "[[", 2))
  ascdepth <- (sapply(strsplit(names(rasters[[i]]), "_"), "[[", 5))
  ascvar1 <- (sapply(strsplit(names(rasters[[i]]), "_"), "[[", 3))
  ascvar2 <- (sapply(strsplit(names(rasters[[i]]), "_"), "[[", 4))
  ascfile <- rasters[i]


    if (ascyear == year & ascmonth == month & ascvar1 == tempvar & ascvar2 == depthvar & ascdepth == depth){
    #print(ascfile)
    temp_depth <- ascfile[[1]]
    names(temp_depth) <- "temp_depth"
  } else if (ascyear == year & ascmonth == month & ascvar1 == chlvar & ascvar2 == surfacevar & ascdepth == depth){
    chl_surface <- ascfile[[1]]
    names(chl_surface) <- "chl_surface"
  } else if (ascyear == year & ascmonth == month & ascvar1 == o2var & ascvar2 == depthvar & ascdepth == depth){
    o2_depth <- ascfile[[1]]
    names(o2_depth) <- "o2_depth"
  } else if (ascyear == year & ascmonth == month & ascvar1 == salvar & ascvar2 == depthvar & ascdepth == depth){
    salinity_depth <- ascfile[[1]]
    names(salinity_depth) <- "salinity_depth"
  } else if (ascyear == year & ascmonth == month & ascvar1 == naovar & ascvar2 == wintervar){
    nao_winter <- ascfile[[1]]
    names(nao_winter) <- "nao_winter"
  } else if (ascyear == year & ascmonth == month  & ascvar1 == naovar & ascvar2 == samplevar){
    nao_sample <- ascfile[[1]]
    names(nao_sample) <- "nao_sample"

  }
   st19980186.9 <- stack(temp_depth, chl_surface, o2_depth, salinity_depth, nao_sample, nao_winter)
  }
st19980186.9
```




messing with code to see if can do for unique year month depth

# now loop to create stacks
janpres <- read.csv("../output/bio/maxenttestjanpr.csv", header = TRUE)
janpres$occ <- 1
janab <- read.csv("../output/bio/maxenttestjanab.csv", header = TRUE)
janab$occ <- 0
prab <- rbind(janpres, janab)
prab$originalscientificname <- "cap" #because species name needs to be the same
pa <- prab$occ
prab <- subset(prab, select = -c(x, y, occ, originalscientificname)) #ok so for maxent in r just need the variables
prab

system.file("java", package="dismo") #finding location to put maxent jar file
system("java -version")
mod1 <- maxent(x = prab, p = pa, path = paste0("../output/maxentout"), args =  c("responsecurves"), save(md, file = "../output/maxentmod"))
pre1 <- predict(mod1, test) #,  args='outputformat=cloglog'
plot(pre1)
plot(mod1)





#maxent
maxnet throwing errors...
```{r}
janpres <- read.csv("../output/bio/maxenttestjanpr.csv", header = TRUE)
janpres$occ <- 1
janab <- read.csv("../output/bio/maxenttestjanab.csv", header = TRUE)
janab$occ <- 0
prab <- rbind(janpres, janab)
prab$originalscientificname <- "cap" #because species name needs to be the same
pa <- prab$occ
prab <- subset(prab, select = -c(x, y, occ, originalscientificname)) #ok so for maxent in r just need the variables
prab

system.file("java", package="dismo") #finding location to put maxent jar file
system("java -version")
mod1 <- maxent(x = prab, p = pa, path = paste0("../output/maxentout"), args =  c("responsecurves"), save(md, file = "../output/maxentmod"))
pre1 <- predict(mod1, test) #,  args='outputformat=cloglog'
plot(pre1)
plot(mod1)

o2_depth <- raster("../data/jan_test_86.9/2005_01_o2.nc_0.50576.asc")
names(o2_depth) <- "o2_depth"

test2 <- stack(temp_depth, salinity_depth, o2_depth, chl_surface)
prab2 <- subset(prab, select = -c(nao_sample, nao_winter)) #ok so for maxent in r just need the variables
mod2 <- maxent(x = prab2, p = pa, path = paste0("../output/maxentout"), args =  c("responsecurves"), save(md, file = "../output/maxentmod"))
pre2 <- predict(mod2, test2)
plot(pre2)
plot(pre1)
```




```{r}
# now loop to create stacks
janpres <- read.csv("../output/bio/maxenttestjanpr.csv", header = TRUE)
janpres$occ <- 1
janab <- read.csv("../output/bio/maxenttestjanab.csv", header = TRUE)
janab$occ <- 0
prab <- rbind(janpres, janab)
prab$originalscientificname <- "cap" #because species name needs to be the same
pa <- prab$occ
prab <- subset(prab, select = -c(x, y, occ, originalscientificname)) #ok so for maxent in r just need the variables
prab

#THIS IS THE GOOD CODE!
unlayer <- read.csv("../data/env/asc_layerlist1998.csv", header = TRUE)
unlayer <- subset(unlayer, ascmonths == 1)
unlayer <- unlayer[-c(1), ]
unlayer[] <- lapply(unlayer, as.character) #from https://stackoverflow.com/questions/2851015/convert-data-frame-columns-from-factors-to-characters
aea <- raster("../output/env/aea.tif") 

for (td in 1:nrow(unlayer)){
  temp_depth <- raster(unlayer$temp_depth[td])
  crs(temp_depth) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
  names(temp_depth) <- "temp_depth"
  temp_depth <- projectRaster(temp_depth, aea)
  chl_surface <- raster(unlayer$chl_surface[td])
  crs(chl_surface) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
  names(chl_surface) <- "chl_surface"
  chl_surface <- projectRaster(chl_surface, aea)
  o2_depth <- raster(unlayer$o2_depth[td])
  crs(o2_depth) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
  names(o2_depth) <- "o2_depth"
  o2_depth <- projectRaster(o2_depth, aea)
  salinity_depth <- raster(unlayer$salinity_depth[td])
  crs(salinity_depth) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
  names(salinity_depth) <- "salinity_depth"
  salinity_depth <- projectRaster(salinity_depth, aea)
  nao_sample <- raster(unlayer$nao_sample[td])
  crs(nao_sample) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
  names(nao_sample) <- "nao_sample"
  nao_sample <- projectRaster(nao_sample, aea)
  nao_winter <- raster(unlayer$nao_winter[td])
  crs(nao_winter) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"
  names(nao_winter) <- "nao_winter"
  nao_winter <- projectRaster(nao_winter, aea)
  stackn <- unlayer$stackname[td]
  test <- stack(temp_depth, chl_surface, o2_depth, salinity_depth, nao_sample, nao_winter)
  #stackSave(test,unlayer$stackname[td])
  pred <- predict(mod1, test, file = paste0("../output/maxentpredict/", stackn, ".asc"), overwrite=FALSE) 
  paste("maxplot_", stackn, ".png", sep = "") # to automatically save the plot to a png AND show it inline
  #preplot <- plot(pred, png(paste0("../output/maxentpredict/", stackn, ".png"))) #keep these out if using xvalidation
  #dev.off() # stops automatic saving of the plot to a png #keep these out if using xvalidation
}





```

testing model fiddling

```{r fiddling with maxent args}
janpres <- read.csv("../output/bio/maxenttestjanpr.csv", header = TRUE)
janpres$occ <- 1
janab <- read.csv("../output/bio/maxenttestjanab.csv", header = TRUE)
janab$occ <- 0
prab <- rbind(janpres, janab)
prab$originalscientificname <- "cap" #because species name needs to be the same
pa <- prab$occ
prab <- subset(prab, select = -c(x, y, occ, originalscientificname)) #ok so for maxent in r just need the variables
prab
#write.csv(prab, "../output/bio/maxjan98test.csv", row.names = FALSE)


stacklist <- read.csv("../data/env/asc_layerlist1998.csv", header = TRUE)
stacklist <- subset(stacklist, stackname == "st199801000120")
stacklist[] <- lapply(stacklist, as.character)
stacklist
aea <- raster("../output/env/aea.tif") 

temp_depth <- raster(stacklist$temp_depth)
crs(temp_depth) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(temp_depth) <- "temp_depth"
temp_depth <- projectRaster(temp_depth, aea)
chl_surface <- raster(stacklist$chl_surface)
crs(chl_surface) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(chl_surface) <- "chl_surface"
chl_surface <- projectRaster(chl_surface, aea)
o2_depth <- raster(stacklist$o2_depth)
crs(o2_depth) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(o2_depth) <- "o2_depth"
o2_depth <- projectRaster(o2_depth, aea)
salinity_depth <- raster(stacklist$salinity_depth)
crs(salinity_depth) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(salinity_depth) <- "salinity_depth"
salinity_depth <- projectRaster(salinity_depth, aea)
nao_sample <- raster(stacklist$nao_sample)
crs(nao_sample) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(nao_sample) <- "nao_sample"
nao_sample <- projectRaster(nao_sample, aea)
nao_winter <- raster(stacklist$nao_winter)
crs(nao_winter) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"
names(nao_winter) <- "nao_winter"
nao_winter <- projectRaster(nao_winter, aea)

test <- stack(temp_depth, chl_surface, o2_depth, salinity_depth, nao_sample, nao_winter)

system.file("java", package="dismo") #finding location to put maxent jar file
system("java -version")


mod1 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000")) #maxiterations increased to ensure model convergence
mod1

pre1 <- predict(mod1, test, args='outputformat=raw' ) 
preplot1 <- plot(pre1)
preplot1

pre2 <- predict(mod1, test, args='outputformat=logistic' ) 
preplot2 <- plot(pre2)
preplot2

pre3 <- predict(mod1, test, args='outputformat=cloglog' ) 
preplot3 <- plot(pre3)
preplot3

#------------------------

mod2 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "defaultprevalence=0.8")) # changing the prev seems to do nothing
mod2

mod3 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "defaultprevalence=0.1")) # changing the prev seems to do nothing
mod3

pre2.2 <- predict(mod2, test, args='outputformat=logistic' ) 
preplot2.2 <- plot(pre2.2)
preplot2.2

pre2.3 <- predict(mod3, test, args='outputformat=logistic' ) 
preplot2.3 <- plot(pre2.3)
preplot2.3

#-----------------------------

mod4 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE")) 
mod4

mod5 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "maximumbackground=100")) #because i am using swd, this command is overwridden.  
mod5

pre5 <- predict(mod5, test, args='outputformat=logistic' ) 
preplot5 <- plot(pre5)
preplot5

#-----------------------

mod6 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "replicates=5", "replicatetype=crossvalidate")) #replicates with crossvalidate result in multiple map outputs (one for each replicate). It is not possible to 'merge' these maps https://stackoverflow.com/questions/28885987/r-how-to-get-one-summary-prediction-map-instead-for-5-when-using-5-fold-cros
mod6

pre6 <- predict(mod6, test, args='outputformat=logistic' ) 
preplot6 <- plot(pre6)
preplot6

#-----------------------
strt <- Sys.time() #get the start time
mod7 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8")) #threads should speed things up...
mod7

pre7 <- predict(mod7, test, args='outputformat=logistic' ) 
preplot7 <- plot(pre7)
preplot7
print(Sys.time()-strt) #time it took to run

#43 secs

strt <- Sys.time() #get the start time
mod7.2 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE"))
mod7.2

pre7.2 <- predict(mod7.2, test, args='outputformat=logistic' ) 
preplot7.2 <- plot(pre7)
preplot7.2
print(Sys.time()-strt) #time it took to run

#1.75 mins

#conf that threads does indeed speed up process

#---------------------
#follwoing radosavljevic 2014


mod8.1 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "betamultiplier=0.25")) #playing with multiplier
mod8.1

pre8.1 <- predict(mod8.1, test, args=c('outputformat=logistic'), file="../output/maxtest.asc") # here i added an asc output so i could pop into arc for a test
preplot8.1 <- plot(pre8.1)
preplot8.1

mod8 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8")) #default setting for betam is 1
mod8

pre8 <- predict(mod8, test, args='outputformat=logistic' ) 
preplot8 <- plot(pre8)
preplot8

mod8.4 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "betamultiplier=1.25")) #playing with multiplier
mod8.4

pre8.4 <- predict(mod8.4, test, args='outputformat=logistic' ) 
preplot8.4 <- plot(pre8.4)
preplot8.4

mod8.2 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "betamultiplier=2")) 
mod8.2

pre8.2 <- predict(mod8.2, test, args='outputformat=logistic' ) 
preplot8.2 <- plot(pre8.2)
preplot8.2

mod8.3 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "betamultiplier=6")) 
mod8.3

pre8.3 <- predict(mod8.3, test, args='outputformat=logistic' ) 
preplot8.3 <- plot(pre8.3)
preplot8.3


#--------------------------

#play with test and training data - note will want to give your own file in the 'real model'
mod9 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30")) 
mod9

pre9 <- predict(mod9, test, args='outputformat=logistic' ) 
preplot9 <- plot(pre9)
preplot9

#ok this works but doesnt show much difference in the map


#------------------------

#run a model with all years data and project as you have been 
presaball <- read.csv("../output/bio/presab_10k.csv", header = TRUE)
subpresaball <- subset(presaball, select = c(occurrence, temp_depth, chl_surface, o2_depth, salinity_depth, nao_sample, nao_winter))
subpaall <- subpresaball$occurrence
subpresaball <- subset(subpresaball, select = -c(occurrence))

mod10 <- maxent(x = subpresaball, p = subpaall, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30")) 
mod10

pre10 <- predict(mod10, test, args='outputformat=logistic' ) 
preplot10 <- plot(pre10)
preplot10

# well this makes a terrible mess... the habitat is predicted to be everywhere and the response curves a mess! Was just curious. 

#--------------------

#back to fiddling

mod11 <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "replicates=10")) #replicates added
mod11

pre11 <- predict(mod11, test, args='outputformat=logistic' ) 
preplot11 <- plot(pre11)
preplot11

#probably dont want replicates - no real way to merge the outputs. saw somehting online that said ideally you want to run just one model

#-------------------

mod12 <- maxent(x = prab, p = pa, file = .asc, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE", "replicatetype=crossvalidate", "replicates=5")) #add to samples because field study with biased data - see https://esajournals.onlinelibrary.wiley.com/doi/10.1890/10-1171.1. note this should be the default but keep here as a note
mod12

mod12[2]

pre12 <- predict(mod12, test, args='outputformat=logistic' ) 
preplot12 <- plot(pre12)
preplot12

#ok think i am good. the think you will want to change is the beta value - depending on the results of the AIC and when you figure out the test/training data partion, will need to add testsamplesfile  


```


one maxent run with all variables


```{r maxent with all variables}
presaball <- read.csv("../output/bio/presab_10k.csv", header = TRUE)
janpresaball <- subset(presaball, month == 1)
janpresaball <- subset(janpresaball, select = c(occurrence, temp_depth, temp_surface, chl_depth, chl_surface, o2_depth, o2_surface, salinity_depth, salinity_surface, ssh_surface, mlp_surface, nao_sample, nao_prev, nao_winter, amo_sample, amo_prev, amo_winter))
paall <- janpresaball$occurrence
janpresaball <- subset(janpresaball, select = -c(occurrence))

stacklist <- read.csv("../data/env/asc_layerlist1998.csv", header = TRUE)
stacklist <- subset(stacklist, stackname == "st199801000120")
stacklist[] <- lapply(stacklist, as.character)
stacklist
aea <- raster("../output/env/aea.tif") 

temp_depth <- raster(stacklist$temp_depth)
crs(temp_depth) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(temp_depth) <- "temp_depth"
temp_depth <- projectRaster(temp_depth, aea)
temp_surface <- raster(stacklist$temp_surface)
crs(temp_surface) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(temp_surface) <- "temp_surface"
temp_surface <- projectRaster(temp_surface, aea)
chl_depth <- raster(stacklist$chl_depth)
crs(chl_depth) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(chl_depth) <- "chl_depth"
chl_depth <- projectRaster(chl_depth, aea)
chl_surface <- raster(stacklist$chl_surface)
crs(chl_surface) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(chl_surface) <- "chl_surface"
chl_surface <- projectRaster(chl_surface, aea)
o2_depth <- raster(stacklist$o2_depth)
crs(o2_depth) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(o2_depth) <- "o2_depth"
o2_depth <- projectRaster(o2_depth, aea)
o2_surface <- raster(stacklist$o2_surface)
crs(o2_surface) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(o2_surface) <- "o2_surface"
o2_surface <- projectRaster(o2_surface, aea)
salinity_depth <- raster(stacklist$salinity_depth)
crs(salinity_depth) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(salinity_depth) <- "salinity_depth"
salinity_depth <- projectRaster(salinity_depth, aea)
salinity_surface <- raster(stacklist$salinity_surface)
crs(salinity_surface) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(salinity_surface) <- "salinity_surface"
salinity_surface <- projectRaster(salinity_surface, aea)
ssh_surface <- raster(stacklist$ssh_surface)
crs(ssh_surface) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(ssh_surface) <- "ssh_surface"
ssh_surface <- projectRaster(ssh_surface, aea)
mlp_surface <- raster(stacklist$mlp_surface)
crs(mlp_surface) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(mlp_surface) <- "mlp_surface"
mlp_surface <- projectRaster(mlp_surface, aea)
nao_sample <- raster(stacklist$nao_sample)
crs(nao_sample) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(nao_sample) <- "nao_sample"
nao_sample <- projectRaster(nao_sample, aea)
nao_prev <- raster(stacklist$nao_prev)
crs(nao_prev) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(nao_prev) <- "nao_prev"
nao_prev <- projectRaster(nao_prev, aea)
nao_winter <- raster(stacklist$nao_winter)
crs(nao_winter) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"
names(nao_winter) <- "nao_winter"
nao_winter <- projectRaster(nao_winter, aea)
amo_sample <- raster(stacklist$amo_sample)
crs(amo_sample) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(amo_sample) <- "amo_sample"
amo_sample <- projectRaster(amo_sample, aea)
amo_prev <- raster(stacklist$amo_prev)
crs(amo_prev) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
names(amo_prev) <- "amo_prev"
amo_prev <- projectRaster(amo_prev, aea)
amo_winter <- raster(stacklist$amo_winter)
crs(amo_winter) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"
names(amo_winter) <- "amo_winter"
amo_winter <- projectRaster(amo_winter, aea)

testall <- stack(temp_depth, temp_surface, chl_depth, chl_surface, o2_depth, o2_surface, salinity_depth, salinity_surface, ssh_surface, mlp_surface, nao_sample, nao_prev, nao_winter, amo_sample, amo_prev, amo_winter)

system.file("java", package="dismo") #finding location to put maxent jar file
system("java -version")

mod1all <- maxent(x = janpresaball, p = paall, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8")) 
mod1all

pre1all <- predict(mod1all, testall, args='outputformat=logistic' ) 
preplot1all <- plot(pre1all)
preplot1all

```

# maxentvariableselection package

https://cran.r-project.org/web/packages/MaxentVariableSelection/MaxentVariableSelection.pdf + https://cran.r-project.org/web/packages/MaxentVariableSelection/vignettes/MaxentVariableSelection.pdf

with all variables
```{r maxent variable selection package - not used}
janaball <- read.csv("../output/bio/background_10k.csv", header = TRUE)
janpresall <- read.csv("../output/bio/pres_nomissing.csv", header = TRUE)
janpresaball <- rbind.fill(janaball, janpresall)
janpresaball <- subset(janpresaball, month == 1)
janpresaball <- subset(janpresaball, select = c(occurrence, longitude_meters, latitude_meters, temp_depth, temp_surface, chl_depth, chl_surface, o2_depth, o2_surface, salinity_depth, salinity_surface, ssh_surface, mlp_surface, nao_sample, nao_prev, nao_winter, amo_sample, amo_prev, amo_winter))
names(janpresaball)[names(janpresaball)=="occurrence"] <- "species"
names(janpresaball)[names(janpresaball)=="longitude_meters"] <- "longitude"
names(janpresaball)[names(janpresaball)=="latitude_meters"] <- "latitude"
janpresall <- subset(janpresaball, species == 1)
janpresall$species <- replace(janpresall$species, janpresall$species == "1", "fish")
write.csv(janpresall, "../output/maxentvariableselection/presence.csv", row.names = FALSE)
janaball <- subset(janpresaball, species == 0)
janpresall$species <- replace(janpresall$species, janpresall$species == "0", "bg")
write.csv(janaball, "../output/maxentvariableselection/background.csv", row.names = FALSE)


VariableSelection(maxent="C:/Users/bunny/Downloads/maxent/maxent.jar", outdir=("C:/Users/bunny/Documents/GitHub/Chapter_1/output/maxentvariableselection/output"), gridfolder=("C:/Users/bunny/Documents/GitHub/Chapter_1/output/maxentvariableselection/testgrid"), occurrencelocations= ("C:/Users/bunny/Documents/GitHub/Chapter_1/output/maxentvariableselection/presence.csv"), backgroundlocations= ("C:/Users/bunny/Documents/GitHub/Chapter_1/output/maxentvariableselection/background.csv"), additionalargs="nolinear noquadratic noproduct nothreshold noautofeature", contributionthreshold=5, correlationthreshold=0.9, betamultiplier=seq(0.5, 3, 0.25))
```




with my manually selected variables for jan (temp_depth, chl_surface, o2_depth, salinity_depth, nao_sample, nao_winter)
```{r}
janaball <- read.csv("../output/bio/background_10k.csv", header = TRUE)
janpresall <- read.csv("../output/bio/pres_nomissing.csv", header = TRUE)
janpresaball_red <- rbind.fill(janaball, janpresall)
janpresaball_red <- subset(janpresaball_red, month == 1)
janpresaball_red <- subset(janpresaball_red, select = c(occurrence, longitude_meters, latitude_meters, temp_depth, chl_surface, o2_depth, salinity_depth, nao_sample, nao_winter))
names(janpresaball_red)[names(janpresaball_red)=="occurrence"] <- "species"
names(janpresaball_red)[names(janpresaball_red)=="longitude_meters"] <- "longitude"
names(janpresaball_red)[names(janpresaball_red)=="latitude_meters"] <- "latitude"
janpresall_red <- subset(janpresaball_red, species == 1)
janpresall_red$species <- replace(janpresall_red$species, janpresall_red$species == "1", "fish")
write.csv(janpresall_red, "../output/maxentvariableselection/presence_red.csv", row.names = FALSE)
janaball_red <- subset(janpresaball_red, species == 0)
janpresall_red$species <- replace(janpresall_red$species, janpresall_red$species == "0", "bg")
write.csv(janaball_red, "../output/maxentvariableselection/background_red.csv", row.names = FALSE)


VariableSelection(maxent="C:/Users/bunny/Downloads/maxent/maxent.jar", outdir=("C:/Users/bunny/Documents/GitHub/Chapter_1/output/maxentvariableselection/output"), gridfolder=("C:/Users/bunny/Documents/GitHub/Chapter_1/output/maxentvariableselection/testgrid"), occurrencelocations= ("C:/Users/bunny/Documents/GitHub/Chapter_1/output/maxentvariableselection/presence_red.csv"), backgroundlocations= ("C:/Users/bunny/Documents/GitHub/Chapter_1/output/maxentvariableselection/background_red.csv"), additionalargs="nolinear noquadratic noproduct nothreshold noautofeature", contributionthreshold=5, correlationthreshold=0.9, betamultiplier=seq(0.25, 3, 0.25))
```

so this is all lovely... the two runs suggest b-multipliers of <1 (0.75 and 0.25 respectively). In my test runs above, 0.25 gives a 'tighter fit' thatn 1 (the default). Apparently changin the b-multiplier helps reduce over and underfitting... "the default setting in Maxent is 1. Smaller values will constrain the model more, whereas larger numbers will relax the model, making it “smoother”...... 

try changing some of the settings here - paerticularly you want aic
```{r}
VariableSelection(maxent="C:/Users/bunny/Downloads/maxent/maxent.jar", outdir=("C:/Users/bunny/Documents/GitHub/Chapter_1/output/maxentvariableselection/output"), gridfolder=("C:/Users/bunny/Documents/GitHub/Chapter_1/output/maxentvariableselection/testgrid"), occurrencelocations= ("C:/Users/bunny/Documents/GitHub/Chapter_1/output/maxentvariableselection/presence_red.csv"), backgroundlocations= ("C:/Users/bunny/Documents/GitHub/Chapter_1/output/maxentvariableselection/background_red.csv"), additionalargs="nohinge", contributionthreshold=5, correlationthreshold=0.9, betamultiplier=seq(0.25, 2, 0.25))
```
no you cant - you need to use the grids...

maybe try enmeval? NO CAN'T USE WITH SWD https://groups.google.com/forum/#!topic/maxent/lIT4tY_6toY


# for mj thing - no points per nafo zone

I previously worked out the area for each nafo zone in arcgis. This caclulates the  number of points per nafo zone

```{r}
allpoints <- read.csv("../output/bio/background/correct_random_files/background_point_na_removal_nona.csv", header = TRUE) #you may want to move the files once you figure out what mess you created..
nafo_points <- count(allpoints, "nafo_zone")
total_points <- sum(nafo_points$freq) #191055 -correct
nafo_points$points_percentage <- (nafo_points$freq/total_points)*100

#combine with the arcgis output...
nafovolume <- read.csv("../data/env/volume_all_nafo.csv", header = TRUE) #note the hudson strait points will be invalid as there is no polygon to calculate volume on. change to NA
nafo_points$volume <- nafovolume$Volume
nafo_points$volume_percentage <- nafovolume$volume_perc

write.csv(nafo_points, file = "../output/env/no_points_per_nafo.csv")
```

#AIC for regularization

```{r AIC for regularization selection}
#aic fiddling

AIClist <- read.csv("../data/env/AICcCalculations.csv", header = TRUE)

betamval <- 0.25
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=0.25"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual + https://esajournals.onlinelibrary.wiley.com/doi/full/10.1890/10-1171.1.... lets try automate some of this.. 

#count number of non-zero coefficients, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 0.50
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=0.50"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)


for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 0.75
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=0.75"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 1
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=1"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 1.25
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=1.25"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 1.50
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=1.50"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 1.75
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=1.75"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 2
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=2"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 2.25
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=2.25"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 2.50
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=2.50"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 2.75
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=2.75"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 3
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=3"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 3.25
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=3.25"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 3.50
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=3.50"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 3.75
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=3.75"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

betamval <- 4
modaic <- maxent(x = prab, p = pa, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "randomtestpoints=30", "betamultiplier=4"), path = "../output/maxent/output/mod9foraic") 

#now based on glover-kapfer pdf with excel manual.... lets try automate some of this..

#count number of non-zero coefficinets, excluding the final four rows
coefile <- read.csv("../output/maxent/output/mod9foraic/species.lambdas", header = FALSE)
coefile <- head(coefile, -4)
coefile2 <- subset(coefile, V2 > 0 | V2 < 0)
nocoeff <- nrow(coefile2)

#no presences used in model (less those used for testing)
maxresults <- read.csv("../output/maxent/output/mod9foraic/maxentResults.csv", header = TRUE)
notrainingpoints <- maxresults$X.Training.samples
testauc <- maxresults$Test.AUC
trainauc <- maxresults$Training.AUC

#natural log
samplepred <- read.csv("../output/maxent/output/mod9foraic/species_samplePredictions.csv", header = TRUE)
samplepred$nat_log <- log(samplepred$Raw.prediction)
sumsamplepred <- sum(samplepred$nat_log)

for (i in 1:nrow(AIClist)){
  if(AIClist$regularization[i] == betamval){
    AIClist$Test.AUC[i] <- testauc
    AIClist$Train.AUC[i] <- trainauc
    AIClist$n[i] <- notrainingpoints
    AIClist$coefficients[i] <- nocoeff
    AIClist$sum.of.logs[i] <- sumsamplepred
    
  }
}

AIClist$AIC <- ((2*AIClist$coefficients)-(2*AIClist$sum.of.logs))
AIClist$AICc <- (-2*(AIClist$sum.of.logs)+((2*AIClist$coefficients)*(AIClist$n/(AIClist$n - AIClist$coefficients-1))))

write.csv(AIClist, "../output/bio/AICforMaxentReg.csv", row.names = FALSE)
```


#subset background points

```{r}
# now loop to create stacks
janpres <- read.csv("../output/bio/maxenttestjanpr.csv", header = TRUE)
janpres$occ <- 1
janab <- read.csv("../output/bio/maxenttestjanab.csv", header = TRUE)
janab$occ <- 0

#subset2500 randomly
janab25 <- sample_n(janab, 2500)

prab <- rbind(janpres, janab25)
prab$originalscientificname <- "cap" #because species name needs to be the same
pa <- prab$occ
prab <- subset(prab, select = -c(x, y, occ, originalscientificname)) #ok so for maxent in r just need the variables

mod13 <- maxent(x = prab, p = pa, file = .asc, args=c("maximumiterations=5000", "responsecurves=TRUE", "jackknife=TRUE", "threads=8", "addsamplestobackground=TRUE")) 

#THIS IS THE GOOD CODE!
unlayer <- read.csv("../data/env/asc_layerlist1998.csv", header = TRUE)
unlayer <- subset(unlayer, ascmonths == 1)
unlayer <- unlayer[-c(1), ]
unlayer[] <- lapply(unlayer, as.character) #from https://stackoverflow.com/questions/2851015/convert-data-frame-columns-from-factors-to-characters
aea <- raster("../output/env/aea.tif") 

for (td in 1:nrow(unlayer)){
  temp_depth <- raster(unlayer$temp_depth[td])
  crs(temp_depth) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
  names(temp_depth) <- "temp_depth"
  temp_depth <- projectRaster(temp_depth, aea)
  chl_surface <- raster(unlayer$chl_surface[td])
  crs(chl_surface) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
  names(chl_surface) <- "chl_surface"
  chl_surface <- projectRaster(chl_surface, aea)
  o2_depth <- raster(unlayer$o2_depth[td])
  crs(o2_depth) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
  names(o2_depth) <- "o2_depth"
  o2_depth <- projectRaster(o2_depth, aea)
  salinity_depth <- raster(unlayer$salinity_depth[td])
  crs(salinity_depth) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
  names(salinity_depth) <- "salinity_depth"
  salinity_depth <- projectRaster(salinity_depth, aea)
  nao_sample <- raster(unlayer$nao_sample[td])
  crs(nao_sample) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0" 
  names(nao_sample) <- "nao_sample"
  nao_sample <- projectRaster(nao_sample, aea)
  nao_winter <- raster(unlayer$nao_winter[td])
  crs(nao_winter) <- "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"
  names(nao_winter) <- "nao_winter"
  nao_winter <- projectRaster(nao_winter, aea)
  stackn <- unlayer$stackname[td]
  test <- stack(temp_depth, chl_surface, o2_depth, salinity_depth, nao_sample, nao_winter)
  #stackSave(test,unlayer$stackname[td])
  pred <- predict(mod13, test, file = paste0("../output/maxentpredict/", stackn, ".asc"), overwrite=FALSE) 
  paste("maxplot_", stackn, ".png", sep = "") # to automatically save the plot to a png AND show it inline
  #preplot <- plot(pred, png(paste0("../output/maxentpredict/", stackn, ".png"))) #keep these out if using xvalidation
  #dev.off() # stops automatic saving of the plot to a png #keep these out if using xvalidation
}
```
